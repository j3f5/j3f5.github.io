<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>JWT安全 | J3fffff&#39;s Blog</title><meta name="description" content="JWT概念 JSON Web Token（简称 JWT）是目前最流行的跨域认证解决方案。是一种认证授权机制。   组成部分  上面是使用base64编码的。头部和声明 部分都由JSON对象表示。头部 描述了应用于JWT的加密操作，以及JWT的附加属性，可以选择。声明代表一个JSON对象，其成员是JWT所传达的声明。 我们可以使用这个工具来解密：https:&#x2F;&#x2F;jwt.io&#x2F;  头部 Header"><meta property="og:type" content="article"><meta property="og:title" content="JWT安全"><meta property="og:url" content="https://j3f5.github.io/articles/2023/06/07/JWT%E5%AE%89%E5%85%A8/index.html"><meta property="og:site_name" content="J3fffff&#39;s Blog"><meta property="og:description" content="JWT概念 JSON Web Token（简称 JWT）是目前最流行的跨域认证解决方案。是一种认证授权机制。   组成部分  上面是使用base64编码的。头部和声明 部分都由JSON对象表示。头部 描述了应用于JWT的加密操作，以及JWT的附加属性，可以选择。声明代表一个JSON对象，其成员是JWT所传达的声明。 我们可以使用这个工具来解密：https:&#x2F;&#x2F;jwt.io&#x2F;  头部 Header"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/JWT%E5%AE%89%E5%85%A8.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/image-20230607154004007.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/jwt_diagram.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/jwt-flowchart.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/image-20230607161353947.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/image-20230607161318132.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/image-20230607165148603.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/image-20230608113035376.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/image-20230608113958918.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/image-20230608113551369-16861953534983.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/image-20230608113811331.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/image-20230608093247180.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/image-20230608093530949.png"><meta property="og:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/image-20230608122654080.png"><meta property="article:published_time" content="2023-06-07T06:14:47.000Z"><meta property="article:modified_time" content="2023-06-08T06:14:47.000Z"><meta property="article:author" content="Jeff"><meta property="article:tag" content="JWT"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://j3f5.github.io/images/JWT%E5%AE%89%E5%85%A8/JWT%E5%AE%89%E5%85%A8.png"><link rel="canonical" href="https://j3f5.github.io/articles/2023/06/07/JWT%E5%AE%89%E5%85%A8/index.html"><link rel="alternate" href="/atom.xml" title="J3fffff&#39;s Blog" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css">   <link rel="stylesheet" href="/css/theme/monokai-hook.css"><link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet"><meta name="generator" content="Hexo 6.3.0"></head><body class="main-center theme-purple" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">妄想星空</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">Web Pentestor</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Guangzhou, China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">首页</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">归档</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">分类</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">标签</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">关于</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/j3f5" target="_blank" title="Github"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">公告</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">分类</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA%E5%AE%89%E5%85%A8/">JAVA安全</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA%E5%AE%89%E5%85%A8/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/">渗透测试基础</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/">JAVA安全基础</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/">渗透测试基础</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/">开发基础</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/">渗透测试基础</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%A6%E8%81%94%E7%BD%91%E5%9F%BA%E7%A1%80/">车联网基础</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%A6%E8%81%94%E7%BD%91%E6%A0%87%E5%87%86/">车联网标准</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSRF/" rel="tag">CSRF</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT/" rel="tag">JWT</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RCE/" rel="tag">RCE</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSRF/" rel="tag">SSRF</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSS/" rel="tag">XSS</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XXE/" rel="tag">XXE</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag">sql注入</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/waf%E7%BB%95%E8%BF%87/" rel="tag">waf绕过</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91/" rel="tag">业务逻辑</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%AB%E6%8C%81/" rel="tag">劫持</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%8F%E8%AE%AE/" rel="tag">协议</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" rel="tag">博客搭建</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">反序列化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/" rel="tag">审计技巧</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%90%E6%9D%83/" rel="tag">提权</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B/" rel="tag">整体流程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" rel="tag">文件上传</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">文件包含</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" rel="tag">文件读取</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7/" rel="tag">渗透技巧</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/" rel="tag">漏洞发现</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A0%B4%E8%A7%A3/" rel="tag">破解</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%A8%E5%9F%9F/" rel="tag">跨域</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9F/" rel="tag">远程服务系统</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签云</h3><div class="widget-body tagcloud"><a href="/tags/CSRF/" style="font-size:13.33px">CSRF</a> <a href="/tags/JWT/" style="font-size:13px">JWT</a> <a href="/tags/RCE/" style="font-size:13.33px">RCE</a> <a href="/tags/SSRF/" style="font-size:13px">SSRF</a> <a href="/tags/XSS/" style="font-size:13.67px">XSS</a> <a href="/tags/XXE/" style="font-size:13.33px">XXE</a> <a href="/tags/sql%E6%B3%A8%E5%85%A5/" style="font-size:14px">sql注入</a> <a href="/tags/waf%E7%BB%95%E8%BF%87/" style="font-size:13px">waf绕过</a> <a href="/tags/%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91/" style="font-size:13px">业务逻辑</a> <a href="/tags/%E5%8A%AB%E6%8C%81/" style="font-size:13px">劫持</a> <a href="/tags/%E5%8D%8F%E8%AE%AE/" style="font-size:13px">协议</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" style="font-size:13px">博客搭建</a> <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size:13px">反序列化</a> <a href="/tags/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/" style="font-size:13px">审计技巧</a> <a href="/tags/%E6%8F%90%E6%9D%83/" style="font-size:13px">提权</a> <a href="/tags/%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B/" style="font-size:13px">整体流程</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size:13.33px">文件上传</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" style="font-size:13px">文件包含</a> <a href="/tags/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" style="font-size:13px">文件读取</a> <a href="/tags/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7/" style="font-size:13px">渗透技巧</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/" style="font-size:13px">漏洞发现</a> <a href="/tags/%E7%A0%B4%E8%A7%A3/" style="font-size:13px">破解</a> <a href="/tags/%E8%B7%A8%E5%9F%9F/" style="font-size:13px">跨域</a> <a href="/tags/%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9F/" style="font-size:13px">远程服务系统</a></div></div><div class="widget"><h3 class="widget-title">归档</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">六月 2023</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a><span class="archive-list-count">13</span></li></ul></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-body"><ul class="recent-post-list list-unstyled"><li><div class="item-thumb"><a href="/articles/2023/06/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/">渗透测试基础</a></p><p class="item-title"><a href="/articles/2023/06/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" class="title">权限提升</a></p><p class="item-date"><time datetime="2023-06-14T02:42:23.000Z" itemprop="datePublished">2023-06-14</time></p></div></li><li><div class="item-thumb"><a href="/articles/2023/06/14/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E7%82%B9/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a></p><p class="item-title"><a href="/articles/2023/06/14/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E7%82%B9/" class="title">渗透测试需要注意的点</a></p><p class="item-date"><time datetime="2023-06-14T01:08:03.000Z" itemprop="datePublished">2023-06-14</time></p></div></li><li><div class="item-thumb"><a href="/articles/2023/06/12/WAF%E7%BB%95%E8%BF%87-%E4%B8%80%E8%88%AC%E6%80%A7%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/">渗透测试基础</a></p><p class="item-title"><a href="/articles/2023/06/12/WAF%E7%BB%95%E8%BF%87-%E4%B8%80%E8%88%AC%E6%80%A7%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/" class="title">WAF绕过-一般性绕过总结</a></p><p class="item-date"><time datetime="2023-06-12T07:03:07.000Z" itemprop="datePublished">2023-06-12</time></p></div></li><li><div class="item-thumb"><a href="/articles/2023/06/12/HTTP%E4%B8%8E%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/">开发基础</a></p><p class="item-title"><a href="/articles/2023/06/12/HTTP%E4%B8%8E%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/" class="title">HTTP与开发基础</a></p><p class="item-date"><time datetime="2023-06-12T05:25:20.000Z" itemprop="datePublished">2023-06-12</time></p></div></li><li><div class="item-thumb"><a href="/articles/2023/06/12/%E8%BD%A6%E8%81%94%E7%BD%91%E5%9F%BA%E7%A1%80-%E5%8D%8F%E8%AE%AE/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E8%BD%A6%E8%81%94%E7%BD%91%E5%9F%BA%E7%A1%80/">车联网基础</a></p><p class="item-title"><a href="/articles/2023/06/12/%E8%BD%A6%E8%81%94%E7%BD%91%E5%9F%BA%E7%A1%80-%E5%8D%8F%E8%AE%AE/" class="title">车联网基础-协议</a></p><p class="item-date"><time datetime="2023-06-12T02:19:22.000Z" itemprop="datePublished">2023-06-12</time></p></div></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse in" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><nav id="toc" class="article-toc"><h3 class="toc-title">文章目录</h3><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#jwt%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">JWT概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="toc-number">1.1.</span> <span class="toc-text">组成部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%B4%E9%83%A8-header"><span class="toc-number">1.1.1.</span> <span class="toc-text">头部 Header</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E-claims"><span class="toc-number">1.1.2.</span> <span class="toc-text">声明 Claims</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D-signature"><span class="toc-number">1.1.3.</span> <span class="toc-text">签名 Signature</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E4%B8%8E%E8%8E%B7%E5%8F%96jwt%E4%BB%A4%E7%89%8C"><span class="toc-number">1.2.</span> <span class="toc-text">认证与获取JWT令牌</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%B1%BB%E8%AE%BF%E9%97%AEaccess%E4%BB%A4%E7%89%8C%E4%B8%8E%E5%88%B7%E6%96%B0refresh%E4%BB%A4%E7%89%8C"><span class="toc-number">1.3.</span> <span class="toc-text">分类访问(Access)令牌与刷新(Refresh)令牌</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jwt%E7%9A%84%E7%94%A8%E5%A4%84"><span class="toc-number">1.4.</span> <span class="toc-text">JWT的用处</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BC%AA%E9%80%A0%E7%AD%BE%E5%90%8D%E4%BB%A4%E7%89%8C"><span class="toc-number">2.</span> <span class="toc-text">伪造签名令牌</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%AA%E9%80%A0access_token%E6%94%BB%E5%87%BB"><span class="toc-number">2.1.</span> <span class="toc-text">伪造access_token攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%AA%E9%80%A0authorization"><span class="toc-number">2.2.</span> <span class="toc-text">伪造authorization</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%9B%B4%E6%94%B9%E6%97%B6%E9%97%B4-algnone"><span class="toc-number">2.2.1.</span> <span class="toc-text">第一种：更改时间 &amp;&amp; alg&#x3D;none</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E4%BD%BF%E7%94%A8refresh-token"><span class="toc-number">2.2.2.</span> <span class="toc-text">第二种：使用refresh token</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1"><span class="toc-number">2.3.</span> <span class="toc-text">代码审计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9token%E7%BB%86%E8%8A%82%E5%8C%B9%E9%85%8D"><span class="toc-number">2.3.1.</span> <span class="toc-text">更改token细节——匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#refresh-token%E7%94%9F%E6%88%90"><span class="toc-number">2.3.2.</span> <span class="toc-text">refresh token——生成</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%86%E9%92%A5%E7%88%86%E7%A0%B4%E6%94%BB%E5%87%BB"><span class="toc-number">3.</span> <span class="toc-text">密钥爆破攻击</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E5%88%A9%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">综合利用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8Esql%E6%B3%A8%E5%85%A5%E7%BB%93%E5%90%88"><span class="toc-number">4.1.</span> <span class="toc-text">与sql注入结合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nodejs%E5%89%8D%E7%AB%AFjw%E7%99%BB%E5%BD%95%E5%AE%89%E5%85%A8%E4%BC%AA%E9%80%A0admin"><span class="toc-number">4.2.</span> <span class="toc-text">Node.js前端jw登录安全，伪造admin</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E4%BD%BF%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">安全使用</span></a></li></ol></nav></div></aside><main class="main" role="main"><div class="content"><article id="post-JWT安全" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">JWT安全</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check">创建于</i> <a href="/articles/2023/06/07/JWT%E5%AE%89%E5%85%A8/" class="article-date"><time datetime="2023-06-07T06:14:47.000Z" itemprop="datePublished">2023-06-07</time> </a></span><span class="article-updated"><i class="icon icon-calendar-check">更新于</i> <a href="/articles/2023/06/07/JWT%E5%AE%89%E5%85%A8/" class="article-updated"><time datetime="2023-06-08T06:14:47.000Z" itemprop="datePublished">2023-06-08</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/JAVA%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/">JAVA安全基础</a>►<a class="article-category-link" href="/categories/JAVA%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/">渗透测试基础</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/JWT/" rel="tag">JWT</a> </span><span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="/articles/2023/06/07/JWT%E5%AE%89%E5%85%A8/" class="leancloud_visitors" data-flag-title="JWT安全"><span class="leancloud-visitors-count">0</span> </span></span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/articles/2023/06/07/JWT%E5%AE%89%E5%85%A8/#comments" class="article-comment-link">评论</a></span> <span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 3.5k(字)</span> <span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 14(分)</span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h1 id="jwt概念"><a class="markdownIt-Anchor" href="#jwt概念"></a> JWT概念</h1><p>JSON Web Token（简称 JWT）是目前最流行的<strong>跨域认证</strong>解决方案。是一种<strong>认证授权机制</strong>。</p><img src="/images/JWT%E5%AE%89%E5%85%A8/JWT%E5%AE%89%E5%85%A8.png" alt="JWT安全" style="zoom:80%"><h2 id="组成部分"><a class="markdownIt-Anchor" href="#组成部分"></a> 组成部分</h2><p><img src="/images/JWT%E5%AE%89%E5%85%A8/image-20230607154004007.png" alt="image-20230607154004007"></p><p>上面是使用base64编码的。头部和声明 部分都由JSON对象表示。头部 描述了应用于JWT的加密操作，以及JWT的附加属性，可以选择。声明代表一个JSON对象，其成员是JWT所传达的声明。</p><p>我们可以使用这个工具来解密：<a target="_blank" rel="noopener" href="https://jwt.io/">https://jwt.io/</a></p><h3 id="头部-header"><a class="markdownIt-Anchor" href="#头部-header"></a> 头部 Header</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;alg&quot;:&quot;HS256&quot;,</span><br><span class="line">&quot;typ&quot;:&quot;JWT&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>alg</strong></p><blockquote><p>是说明这个JWT 的签名使用的算法的参数，常见值用HS256（默认），HS512 等，也可以为None。HS256表示 HMAC SHA256。</p></blockquote><p><strong>typ</strong></p><blockquote><p>说明这个 token 的类型为 JWT</p></blockquote><h3 id="声明-claims"><a class="markdownIt-Anchor" href="#声明-claims"></a> 声明 Claims</h3><p>令牌包含识别用户的要求，以及服务器满足请求所需的所有其他信息。请注意不要在令牌中存储敏感信息，并始终通过安全通道发送。例如解码得到：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;exp&quot;: 1416471934,</span><br><span class="line">&quot;user_name&quot;: &quot;user&quot;,</span><br><span class="line">&quot;scope&quot;: [</span><br><span class="line">&quot;read&quot;,</span><br><span class="line">&quot;write&quot;</span><br><span class="line">],</span><br><span class="line">&quot;authorities&quot;: [</span><br><span class="line">&quot;ROLE_ADMIN&quot;,</span><br><span class="line">&quot;ROLE_USER&quot;</span><br><span class="line">],</span><br><span class="line">&quot;jti&quot;: &quot;9bc92a44-0b1a-4c5e-be70-da52075b9a84&quot;,</span><br><span class="line">&quot;client_id&quot;: &quot;my-client-with-secret&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JWT 固定参数有：</strong></p><ul><li>iss：发行人</li><li>exp：到期时间</li><li>sub：主题</li><li>aud：用户</li><li>nbf：在此之前不可用</li><li>iat：发布时间</li><li>jti：JWT ID 用于标识该 JWT</li></ul><h3 id="签名-signature"><a class="markdownIt-Anchor" href="#签名-signature"></a> 签名 Signature</h3><p>每个JWT令牌在发送给客户端之前至少应该被<strong>签名</strong>，如果一个令牌没有被签名，客户端应用程序将能够改变令牌的内容。签名规范在这里定义，你可以使用的具体算法在这里描述。基本上，你使用</p><ul><li>HMAC与SHA-2函数</li><li>数字签名与RSASSA-PKCS1-v1_5/ECDSA/RSASSA-PSS 函数</li></ul><p>来签名令牌。在执行任何其他操作之前验证签名是一个重要的步骤。<strong>【需要密钥！】</strong></p><h2 id="认证与获取jwt令牌"><a class="markdownIt-Anchor" href="#认证与获取jwt令牌"></a> 认证与获取JWT令牌</h2><p><img src="/images/JWT%E5%AE%89%E5%85%A8/jwt_diagram.png" alt="jwt diagram"></p><p>在这个流程中，你可以看到</p><ol><li>用户用一个用户名和密码登录，认证成功后，服务器会返回。</li><li>服务器创建一个新的令牌并将这个令牌返回给客户端。</li><li>当客户端连续调用服务器时，它在 &quot;授权 &quot;头中附加了新的令牌。</li><li>服务器读取令牌并首先验证签名，验证成功后，服务器使用令牌中的信息来识别用户。</li></ol><h2 id="分类访问access令牌与刷新refresh令牌"><a class="markdownIt-Anchor" href="#分类访问access令牌与刷新refresh令牌"></a> 分类访问(Access)令牌与刷新(Refresh)令牌</h2><p>通常有两种类型的令牌：访问令牌和刷新令牌。访问令牌用于对服务器进行 API 调用。访问令牌的生命周期有限，这就是刷新令牌的用武之地。一旦访问令牌不再有效，就可以向服务器发出请求，以通过出示刷新令牌来获取新的访问令牌。刷新令牌可以过期，但它们的寿命要长得多。</p><p>这解决了用户必须使用其凭据再次进行身份验证的问题。您是否应该使用刷新令牌和访问令牌取决于以下几点，在选择要使用的令牌时要牢记以下几点。</p><ol><li><p>登录获取令牌：<code>curl -X POST -H -d 'username=webgoat&amp;password=webgoat' localhost:8080/WebGoat/login</code></p></li><li><p>服务器返回令牌：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;token_type&quot;:&quot;bearer&quot;,</span><br><span class="line">    &quot;access_token&quot;:&quot;XXXX.YYYY.ZZZZ&quot;,</span><br><span class="line">    &quot;expires_in&quot;:10,</span><br><span class="line">    &quot;refresh_token&quot;:&quot;4a9a0b1eac1a34201b3c5659944e8b7&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如您所见，<strong>刷新令牌是一个随机字符串</strong>，服务器可以对其进行跟踪（在内存中或存储在数据库中），<strong>以便将刷新令牌与授予刷新令牌的用户相匹配</strong>。因此，在这种情况下，只要访问令牌仍然有效，我们就可以说是“无状态”会话，服务器端设置用户会话没有负担，令牌是自包含的。当访问令牌不再有效时，<strong>服务器需要查询存储的刷新令牌以确保令牌未以任何方式被阻止</strong>。</p></li><li><p><strong>每当攻击者获得访问令牌时，它仅在一定时间内有效（比如 10 分钟）</strong>。然后攻击者需要刷新令牌来获取新的访问令牌。这就是刷新令牌需要更好保护的原因。也可以使刷新令牌无状态，但这意味着将更难查看用户是否撤销了令牌。服务器完成所有验证后，它必须向客户端返回一个新的刷新令牌和一个新的访问令牌。客户端可以使用新的访问令牌进行 API 调用。</p></li></ol><p>无论选择哪种解决方案，您都应该在服务器端存储足够的信息以验证用户是否仍然可信。</p><ul><li><strong>存储 ip 地址</strong></li><li><strong>跟踪使用刷新令牌的次数</strong>（在访问令牌的有效时间窗口内多次使用刷新令牌可能表示奇怪的行为，你可以撤销所有令牌并让用户再次进行身份验证）</li><li><strong>跟踪哪个访问令牌属于哪个刷新令牌</strong>，否则攻击者可能能够使用攻击者的刷新令牌为不同的用户获取新的访问令牌（参见 <a target="_blank" rel="noopener" href="https://emtunc.org/blog/11/2017/jwt-refresh-token-manipulation/">https://emtunc.org/blog/11/2017/jwt-refresh-token-manipulation/</a> 以获得关于此攻击如何工作的精彩文章）</li><li><strong>检查用户的 IP 地址或地理位置</strong>。如果您需要发出新的令牌，请检查位置是否仍然相同，如果不撤销所有令牌并让用户再次进行身份验证。</li></ul><h2 id="jwt的用处"><a class="markdownIt-Anchor" href="#jwt的用处"></a> JWT的用处</h2><p>在现代单页应用程序 (SPA) 中使用刷新令牌是否有意义？正如我们在关于存储令牌的部分中看到的那样，有两种选择：</p><ul><li>Web 存储</li><li>cookie</li></ul><p>这意味着刷新令牌就在访问令牌旁边，因此如果访问令牌泄露，刷新令牌也可能会受到损害。大多数时候当然是有区别的。</p><p>访问令牌在您进行 API 调用时发送，<strong>刷新令牌仅在应获取新访问令牌时发送</strong>，这在大多数情况下是不同的端点。如果您最终在同一台服务器上，您可以选择仅使用访问令牌。</p><p>如上所述，使用访问令牌和单独的刷新令牌为服务器提供了一些杠杆，而不是一遍又一遍地检查访问令牌。仅在用户需要新的访问令牌时执行检查。当然可以只使用访问令牌。在服务器上，您存储的信息与您为刷新令牌存储的信息完全相同，请参阅上一段。这样您每次都需要检查令牌，但这可能适用于不同的应用程序。在存储刷新令牌以进行验证的情况下，保护这些令牌也很重要（至少使用哈希函数将它们存储在数据库中）。</p><p>有很多可用资源质疑使用 JWT 令牌进行客户端到服务器身份验证的用例。<strong>使用 JWT 令牌的最佳位置是服务器到服务器之间的通信</strong>。在普通的 Web 应用程序中，您最好使用普通的旧 cookie。</p><img src="/images/JWT%E5%AE%89%E5%85%A8/jwt-flowchart.png" alt="img" style="zoom:80%"><h1 id="伪造签名令牌"><a class="markdownIt-Anchor" href="#伪造签名令牌"></a> 伪造签名令牌</h1><h2 id="伪造access_token攻击"><a class="markdownIt-Anchor" href="#伪造access_token攻击"></a> 伪造access_token攻击</h2><p>截获数据包，发现</p><img src="/images/JWT%E5%AE%89%E5%85%A8/image-20230607161353947.png" alt="image-20230607161353947" style="zoom:67%"> <img src="/images/JWT%E5%AE%89%E5%85%A8/image-20230607161318132.png" alt="image-20230607161318132" style="zoom:67%"><p>发现里面有个字段为：admin=false，改成true试试看。但是返回一个：token不正确，要检查。所以可能是签名出问题了，我们改了参数值，同步的签名也要进行更改的，但是我们没有密钥，所以后面的签名没办法更改。我们可以尝试更改头部，让它不用密钥加密就好啦，直接 none 走起！操作如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;alg&quot;:&quot;none&quot;&#125;</span><br><span class="line">eyJhbGciOiJub25lIn0=</span><br><span class="line">&#123;&quot;iat&quot;:1686989890,&quot;admin&quot;:&quot;true&quot;,&quot;user&quot;:&quot;Tom&quot;&#125;</span><br><span class="line">eyJpYXQiOjE2ODY5ODk4OTAsImFkbWluIjoidHJ1ZSIsInVzZXIiOiJUb20ifQ==</span><br></pre></td></tr></table></figure><p>但是在HTTP数据传输的过程中，Base64编码中的<code>=+/</code>等特殊的符号通过URL容易产生歧义，所以产生了与URL兼容的Base64 URL编码，所以把<code>=</code>删掉，就构造好了：<code>eyJhbGciOiJub25lIn0.eyJpYXQiOjE2ODY5ODk4OTAsImFkbWluIjoidHJ1ZSIsInVzZXIiOiJUb20ifQ.</code></p><img src="/images/JWT%E5%AE%89%E5%85%A8/image-20230607165148603.png" alt="image-20230607165148603" style="zoom:50%"><h2 id="伪造authorization"><a class="markdownIt-Anchor" href="#伪造authorization"></a> 伪造authorization</h2><p>这个的伪造点在字段：Authorization中。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /WebGoat/JWT/refresh/checkout HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:8080</span><br><span class="line">Content-Length: 0</span><br><span class="line">sec-ch-ua: &quot;Chromium&quot;;v=&quot;112&quot;, &quot;Google Chrome&quot;;v=&quot;112&quot;, &quot;Not:A-Brand&quot;;v=&quot;99&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">Authorization: Bearer null</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>我们有一个JWT token：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzUxMiJ9.eyJpYXQiOjE1MjYxMzE0MTEsImV4cCI6MTUyNjIxNzgxMSwiYWRtaW4iOiJmYWxzZSIsInVzZXIiOiJUb20ifQ.DCoaq9zQkyDH25EcVWKcdbyVfUL4c9D4jRvsqOqvi9iAd4QuqmKcchfbU8FNzeBNF9tLeFXHZLU4yRkq-bjm7Q</span><br></pre></td></tr></table></figure><h3 id="第一种更改时间-algnone"><a class="markdownIt-Anchor" href="#第一种更改时间-algnone"></a> 第一种：更改时间 &amp;&amp; alg=none</h3><p>分析得到这个token早就过期了，那么我们<strong>重新弄一下这个过期时间</strong>，然后把签名去掉。参考上面的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJub25lIn0.eyJpYXQiOjE1MjYxMzE0MTEsImV4cCI6IDE2ODYyOTAzMTgsImFkbWluIjoidHJ1ZSIsInVzZXIiOiJUb20ifQ.</span><br></pre></td></tr></table></figure><h3 id="第二种使用refresh-token"><a class="markdownIt-Anchor" href="#第二种使用refresh-token"></a> 第二种：使用refresh token</h3><p>通常，在响应 JWT 身份验证/刷新请求时，你会得到如下所示的内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;code&quot;:0,&quot;data&quot;:&#123;&quot;access_token&quot;:&quot;XXX.YYY.ZZZ&quot;,&quot;access_token_expiration&quot;:&quot;Thursday, November 9th, 2017, 10:27:33 PM&quot;,&quot;refresh_token&quot;:&quot;ABC123&quot;&#125;&#125;</span><br></pre></td></tr></table></figure><p>此示例中的访问令牌将于10:27:33过期。通常，应用程序将使用刷新令牌在到期日期之前刷新/获取新的访问令牌。该请求将转到授权服务器，如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /auth/refresh HTTP/1.1</span><br><span class="line">Host: auth.example.com</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Authorization: Bearer XXX.YYY.ZZZ</span><br><span class="line"></span><br><span class="line">&#123;&quot;refresh_token&quot;:&quot;ABC123&quot;&#125;</span><br></pre></td></tr></table></figure><p>当前访问令牌位于授权标头中，刷新令牌位于 POST 正文中。作为回报，您将获得一个全新的访问令牌、到期日期和刷新令牌。则我们伪造：<strong>使用我的刷新令牌刷新其他人的访问令牌</strong></p><p><strong>操作如下：</strong></p><ol><li><p>F12查看流量，搜索：refresh_token，得到：</p><img src="/images/JWT%E5%AE%89%E5%85%A8/image-20230608113035376.png" alt="image-20230608113035376" style="zoom:50%"></li><li><p>获取这个refresh_token，还有之前tom的token，抓包贴上（改URL，改content-type…），如下，就可刷新我们的token了，我们的token就不怕过期了！（得到URL的方式也很重要）</p><img src="/images/JWT%E5%AE%89%E5%85%A8/image-20230608113958918.png" alt="image-20230608113958918" style="zoom:50%"> <img src="/images/JWT%E5%AE%89%E5%85%A8/image-20230608113551369-16861953534983.png" alt="image-20230608113551369" style="zoom:50%"></li><li><p>贴上我们刚获得的token，就OK了！</p><img src="/images/JWT%E5%AE%89%E5%85%A8/image-20230608113811331.png" alt="image-20230608113811331" style="zoom:50%"></li></ol><h2 id="代码审计"><a class="markdownIt-Anchor" href="#代码审计"></a> 代码审计</h2><h3 id="更改token细节匹配"><a class="markdownIt-Anchor" href="#更改token细节匹配"></a> 更改token细节——匹配</h3><p>对比下面两个代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">   Jwt jwt = Jwts.parser().setSigningKey(JWT_PASSWORD).parseClaimsJws(accessToken);</span><br><span class="line">   Claims claims = (Claims) jwt.getBody();</span><br><span class="line">   String user = (String) claims.get(&quot;user&quot;);</span><br><span class="line">   boolean isAdmin = Boolean.valueOf((String) claims.get(&quot;admin&quot;));</span><br><span class="line">   if (isAdmin) &#123;</span><br><span class="line">     removeAllUsers();</span><br><span class="line">   &#125; else &#123;</span><br><span class="line">     log.error(&quot;You are not an admin user&quot;);</span><br><span class="line">   &#125;</span><br><span class="line">&#125; catch (JwtException e) &#123;</span><br><span class="line">  throw new InvalidTokenException(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">   Jwt jwt = Jwts.parser().setSigningKey(JWT_PASSWORD).parse(accessToken);</span><br><span class="line">   Claims claims = (Claims) jwt.getBody();</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>就是第2行代码不一样。主要涉及两个函数：</p><ol><li>parseClaimsJws：</li><li>parse</li></ol><h3 id="refresh-token生成"><a class="markdownIt-Anchor" href="#refresh-token生成"></a> refresh token——生成</h3><p>看到代码存在两个POSTMAPPING：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&#123;&quot;/JWT/refresh/checkout&quot;&#125;)</span><br><span class="line">@PostMapping(&#123;&quot;/JWT/refresh/newToken&quot;&#125;)</span><br></pre></td></tr></table></figure><p>第一个是确认订单的，主要看第二个生成refresh token：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(</span></span><br><span class="line"><span class="meta">    value = &#123;&quot;/JWT/refresh/login&quot;&#125;,</span></span><br><span class="line"><span class="meta">    consumes = &#123;&quot;application/json&quot;&#125;,</span></span><br><span class="line"><span class="meta">    produces = &#123;&quot;application/json&quot;&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity <span class="title function_">follow</span><span class="params">(<span class="meta">@RequestBody(required = false)</span> Map&lt;String, Object&gt; json)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (json == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> (String)json.get(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> (String)json.get(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Jerry&quot;</span>.equalsIgnoreCase(user) &amp;&amp; <span class="string">&quot;bm5nhSkxCXZkKRy4&quot;</span>.equals(password) ? ResponseEntity.ok(<span class="built_in">this</span>.createNewTokens(user)) : ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ResponseEntity <span class="title function_">newToken</span><span class="params">(<span class="meta">@RequestHeader(value = &quot;Authorization&quot;,required = false)</span> String token, <span class="meta">@RequestBody(required = false)</span> Map&lt;String, Object&gt; json)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (token != <span class="literal">null</span> &amp;&amp; json != <span class="literal">null</span>) &#123;</span><br><span class="line">            String user;</span><br><span class="line">            String refreshToken;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Jwt&lt;Header, Claims&gt; jwt = Jwts.parser().setSigningKey(<span class="string">&quot;bm5n3SkxCX4kKRy4&quot;</span>).parse(token.replace(<span class="string">&quot;Bearer &quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">                user = (String)((Claims)jwt.getBody()).get(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">                refreshToken = (String)json.get(<span class="string">&quot;refresh_token&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ExpiredJwtException var6) &#123;</span><br><span class="line">                user = (String)var6.getClaims().get(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">                refreshToken = (String)json.get(<span class="string">&quot;refresh_token&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (user != <span class="literal">null</span> &amp;&amp; refreshToken != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (validRefreshTokens.contains(refreshToken)) &#123;</span><br><span class="line">                    validRefreshTokens.remove(refreshToken);</span><br><span class="line">                    <span class="keyword">return</span> ResponseEntity.ok(<span class="built_in">this</span>.createNewTokens(user));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>从上面可以看到，我们需要的Username为Jerry，密码是静态的。那么根据responsebody，我们构造请求包，这里知道是json格式：通过checkout的请求包，将conten-type改为json，然后构造参数，即可获得refresh token。</p><p>在/JWT/refresh/newToken接口，首先接收Authorization的值，进行jwt解码，得到user，然后再从json中得到refresh_token，如果refresh_token有效，则刷新access_token。</p><h1 id="密钥爆破攻击"><a class="markdownIt-Anchor" href="#密钥爆破攻击"></a> 密钥爆破攻击</h1><p>相对于上面，如果我们有密钥，那么我们就可以跟着修改签名，重新构造数据包进行攻击。我们可以发起离线的暴力破解发起对密钥的攻击。字典的话需要自己找。具体流程如下：</p><ol><li><p>抓取到JWT token，分析得到如下：</p><img src="/images/JWT%E5%AE%89%E5%85%A8/image-20230608093247180.png" alt="image-20230608093247180" style="zoom:50%"></li><li><p>将token放到破解脚本里面</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">alg = <span class="string">&quot;HS256&quot;</span></span><br><span class="line">jwt_str = <span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJXZWJHb2F0IFRva2VuIEJ1aWxkZXIiLCJhdWQiOiJ3ZWJnb2F0Lm9yZyIsImlhdCI6MTY4NjE4NzUwOCwiZXhwIjoxNjg2MTg3NTY4LCJzdWIiOiJ0b21Ad2ViZ29hdC5vcmciLCJ1c2VybmFtZSI6IlRvbSIsIkVtYWlsIjoidG9tQHdlYmdvYXQub3JnIiwiUm9sZSI6WyJNYW5hZ2VyIiwiUHJvamVjdCBBZG1pbmlzdHJhdG9yIl19.0TkftJKgV9kqnroqC_5QhsJdkxhl7x65m4ZPSA8Qq4M&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;pass.txt&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        key_ = line.strip()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            jwt.decode(jwt_str, verify=<span class="literal">True</span>, key=key_, algorithms=<span class="string">&quot;HS256&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;found key! --&gt; &#x27;</span> + key_)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>(jwt.exceptions.ExpiredSignatureError, jwt.exceptions.InvalidAudienceError,</span><br><span class="line">               jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.InvalidIssuedAtError,</span><br><span class="line">               jwt.exceptions.ImmatureSignatureError):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;found key! --&gt; &#x27;</span> + key_)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> jwt.exceptions.InvalidSignatureError:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;key not found!&quot;</span>)</span><br></pre></td></tr></table></figure><p>找个好一点的字典直接开干</p></li><li><p>破解到之后，<strong>大概率token已经过期了</strong>，所以重新生成（但是密钥应该不会变），重新构造，例如得到密钥：<code>shipping</code></p><img src="/images/JWT%E5%AE%89%E5%85%A8/image-20230608093530949.png" alt="image-20230608093530949" style="zoom:50%"></li></ol><h1 id="综合利用"><a class="markdownIt-Anchor" href="#综合利用"></a> 综合利用</h1><h2 id="与sql注入结合"><a class="markdownIt-Anchor" href="#与sql注入结合"></a> 与sql注入结合</h2><p>JWT由这个组成，看到kid不是自带的固定字段，所以可能有设么含义：</p><img src="/images/JWT%E5%AE%89%E5%85%A8/image-20230608122654080.png" alt="image-20230608122654080" style="zoom:50%"><p>然后看到源代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ResultSet rs = connection.createStatement().executeQuery(&quot;SELECT key FROM jwt_keys WHERE id = &#x27;&quot; + kid + &quot;&#x27;&quot;);</span><br><span class="line">...</span><br><span class="line">var6 = TextCodec.BASE64.decode(rs.getString(1));</span><br></pre></td></tr></table></figure><p>从Header中获取“kid”直接插入sql查询语句中，存在SQL注入，将返回结果进行了base64解码作为KEY，然后进行解析。然后解析后 ，username参数等于”Tom”，则删除。</p><p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yokan/p/15202333.html">https://www.cnblogs.com/yokan/p/15202333.html</a></p><h2 id="nodejs前端jw登录安全伪造admin"><a class="markdownIt-Anchor" href="#nodejs前端jw登录安全伪造admin"></a> Node.js前端jw登录安全，伪造admin</h2><ol><li><p>注册用户登录，分析：<code>controllers/api.js</code>，看到需要我们伪造用户：admin</p></li><li><p>抓取数据包，进行解密修改后再加密，伪造登录即可</p></li></ol><h1 id="安全使用"><a class="markdownIt-Anchor" href="#安全使用"></a> 安全使用</h1><p>使用 JWT 时的一些最佳实践：</p><ul><li>固定算法，不允许客户端切换算法。</li><li>使用对称密钥对令牌进行签名时，请确保使用适当的密钥长度。</li><li>确保添加到令牌的声明不包含个人信息。如果您需要添加更多信息，也可以选择加密令牌。</li><li>向您的项目添加足够的测试用例以验证无效令牌实际上不起作用。与第三方集成以检查您的令牌并不意味着您根本没有测试您的应用程序。</li></ul></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://j3f5.github.io/articles/2023/06/07/JWT%E5%AE%89%E5%85%A8/" title="JWT安全" target="_blank" rel="external">https://j3f5.github.io/articles/2023/06/07/JWT安全/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">妄想星空</span><small class="ml-1x">Web Pentestor</small></a></h3><div>网安小菜鸡，在线总结</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/articles/2023/06/08/JAVA%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/" title="JAVA常见漏洞与代码审计基础"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li><li class="next"><a href="/articles/2023/06/07/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/" title="反序列化漏洞基础"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li><li class="toggle-toc"><a class="toggle-btn" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button"><span>[&nbsp;</span><span>文章目录</span> <i class="text-collapsed icon icon-anchor"></i> <i class="text-in icon icon-close"></i> <span>]</span></a></li></ul><div class="bar-right"></div></div></nav></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/j3f5" target="_blank" title="Github"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss"><i class="icon icon-rss"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!0,appId:"yCi6g1FoJhBaWWsmJrysnhSM-gzGzoHsz",appKey:"okzCVsRtNdmyQDW34mMUxKOr",placeholder:"留言",avatar:"mm",meta:meta,pageSize:"10",visitor:!0})</script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script><script>$(document).ready(function(){$("article img").not("[hidden]").not(".panel-body img").each(function(){var a,t,n=$(this),e=n.attr("alt"),r=n.parent("a");r.length<1&&(-1!=(t=(a=this.getAttribute("src")).lastIndexOf("?"))&&(a=a.substring(0,t)),r=n.wrap('<a href="'+a+'"></a>').parent("a")),r.attr("data-fancybox","images"),e&&r.attr("data-caption",e)}),$().fancybox({selector:'[data-fancybox="images"]',hash:!1,loop:!1})})</script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px;z-index:2}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>addLoadEvent(()=>{$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code")[0].innerText,n=(e+="\n/**\n* 感谢您复制代码，使用代码请注明引用出处\n* j3fffff @ https://j3f5.github.io\n*/",document.createElement("textarea")),e=(document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus(),document.execCommand("copy"));document.body.removeChild(n),e?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})})</script></body></html>